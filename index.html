<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>EduNavigator - Salesforce Einstein AI for Education</title>
	<style>
    	* {
        	margin: 0;
        	padding: 0;
        	box-sizing: border-box;
    	}

    	body {
        	font-family: 'Salesforce Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        	background-color: #f3f2f2;
        	color: #080707;
    	}

    	/* Salesforce Header */
    	.sf-header {
        	background-color: #0070d2;
        	height: 48px;
        	display: flex;
        	align-items: center;
        	padding: 0 16px;
        	box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    	}

    	.sf-logo {
        	display: flex;
        	align-items: center;
        	gap: 12px;
    	}

    	.einstein-logo {
        	width: 32px;
        	height: 32px;
        	background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>') no-repeat center;
        	background-size: contain;
    	}

    	.app-title {
        	color: white;
        	font-size: 18px;
        	font-weight: 700;
    	}

    	.einstein-badge {
        	background-color: rgba(255,255,255,0.2);
        	color: white;
        	padding: 4px 8px;
        	border-radius: 4px;
        	font-size: 12px;
        	margin-left: 12px;
    	}

    	/* Tab content */
    	.tab-content {
        	display: none;
    	}

    	.tab-content.active {
        	display: block;
    	}

    	/* Salesforce Navigation */
    	.sf-nav {
        	background-color: white;
        	border-bottom: 1px solid #dddbda;
        	padding: 0 16px;
    	}

    	.sf-nav-list {
        	display: flex;
        	list-style: none;
        	gap: 24px;
    	}

    	.sf-nav-item {
        	padding: 12px 0;
        	cursor: pointer;
        	border-bottom: 3px solid transparent;
        	transition: all 0.2s;
    	}

    	.sf-nav-item:hover {
        	color: #0070d2;
    	}

    	.sf-nav-item.active {
        	color: #0070d2;
        	border-bottom-color: #0070d2;
        	font-weight: 600;
    	}

    	/* Main Container */
    	.sf-container {
        	display: flex;
        	height: calc(100vh - 96px);
    	}

    	/* Sidebar */
    	.sf-sidebar {
        	width: 220px;
        	background-color: #fafaf9;
        	border-right: 1px solid #dddbda;
        	padding: 16px 0;
    	}

    	.sf-sidebar-item {
        	padding: 8px 16px;
        	cursor: pointer;
        	display: flex;
        	align-items: center;
        	gap: 8px;
        	transition: background-color 0.2s;
    	}

    	.sf-sidebar-item:hover {
        	background-color: #e5e5e4;
    	}

    	.sf-sidebar-item.active {
        	background-color: #e5e5e4;
        	border-left: 3px solid #0070d2;
        	margin-left: -3px;
        	padding-left: 19px;
    	}

    	/* Content Area */
    	.sf-content {
        	flex: 1;
        	padding: 24px;
        	overflow-y: auto;
    	}

    	/* Sidebar content */
    	.sidebar-content {
        	display: none;
    	}

    	.sidebar-content.active {
        	display: block;
    	}

    	/* Page Header */
    	.page-header {
        	display: flex;
        	justify-content: space-between;
        	align-items: center;
        	margin-bottom: 24px;
    	}

    	.page-header-title {
        	display: flex;
        	align-items: center;
        	gap: 12px;
    	}

    	.page-header h1 {
        	font-size: 24px;
        	font-weight: 700;
        	color: #080707;
    	}

    	/* Einstein AI Box */
    	.einstein-box {
        	background: linear-gradient(135deg, #0070d2 0%, #00a1e0 100%);
        	color: white;
        	padding: 16px;
        	border-radius: 8px;
        	margin-bottom: 24px;
    	}

    	.einstein-box h3 {
        	display: flex;
        	align-items: center;
        	gap: 8px;
        	margin-bottom: 8px;
    	}

    	/* Cards */
    	.sf-card {
        	background-color: white;
        	border-radius: 8px;
        	box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        	margin-bottom: 16px;
        	border: 1px solid #dddbda;
    	}

    	.sf-card-header {
        	padding: 16px;
        	border-bottom: 1px solid #dddbda;
        	font-weight: 600;
        	display: flex;
        	justify-content: space-between;
        	align-items: center;
    	}

    	.sf-card-body {
        	padding: 16px;
    	}

    	/* Buttons */
    	.sf-button {
        	padding: 8px 16px;
        	border-radius: 4px;
        	border: none;
        	font-size: 14px;
        	font-weight: 600;
        	cursor: pointer;
        	transition: all 0.2s;
        	margin-right: 8px;
    	}

    	.sf-button-primary {
        	background-color: #0070d2;
        	color: white;
    	}

    	.sf-button-primary:hover {
        	background-color: #005fb2;
    	}

    	.sf-button-secondary {
        	background-color: white;
        	color: #0070d2;
        	border: 1px solid #0070d2;
    	}

    	.sf-button-secondary:hover {
        	background-color: #f4f6f9;
    	}

    	/* Form Elements */
    	.sf-form-element {
        	margin-bottom: 16px;
    	}

    	.sf-form-label {
        	display: block;
        	font-weight: 600;
        	margin-bottom: 4px;
        	color: #3e3e3c;
    	}

    	.sf-form-input {
        	width: 100%;
        	padding: 8px 12px;
        	border: 1px solid #dddbda;
        	border-radius: 4px;
        	font-size: 14px;
    	}

    	.sf-form-input:focus {
        	outline: none;
        	border-color: #0070d2;
        	box-shadow: 0 0 0 3px rgba(0, 112, 210, 0.1);
    	}

    	/* Navigation buttons container */
    	.nav-buttons {
        	display: flex;
        	justify-content: space-between;
        	margin-top: 24px;
        	padding-top: 16px;
        	border-top: 1px solid #dddbda;
    	}

    	/* Progress Path */
    	.progress-path {
        	display: flex;
        	align-items: center;
        	justify-content: center;
        	margin-bottom: 32px;
    	}

    	.progress-step {
        	display: flex;
        	align-items: center;
        	position: relative;
    	}

    	.progress-circle {
        	width: 32px;
        	height: 32px;
        	border-radius: 50%;
        	background-color: #dddbda;
        	display: flex;
        	align-items: center;
        	justify-content: center;
        	color: white;
        	font-weight: 600;
        	font-size: 14px;
    	}

    	.progress-circle.active {
        	background-color: #0070d2;
    	}

    	.progress-circle.completed {
        	background-color: #4bca81;
    	}

    	.progress-label {
        	position: absolute;
        	top: 40px;
        	left: 50%;
        	transform: translateX(-50%);
        	white-space: nowrap;
        	font-size: 12px;
        	color: #706e6b;
    	}

    	.progress-line {
        	width: 120px;
        	height: 2px;
        	background-color: #dddbda;
        	margin: 0 8px;
    	}

    	.progress-line.completed {
        	background-color: #4bca81;
    	}

    	/* Guided Form */
    	.guided-form {
        	max-width: 600px;
        	margin: 0 auto;
    	}

    	.form-step {
        	display: none;
    	}

    	.form-step.active {
        	display: block;
    	}

    	/* Success message */
    	.success-message {
        	background-color: #d4edda;
        	color: #155724;
        	padding: 16px;
        	border-radius: 8px;
        	margin-top: 16px;
        	display: flex;
        	align-items: center;
        	gap: 8px;
    	}

    	/* Modal Overlay */
    	.modal-overlay {
        	position: fixed;
        	top: 0;
        	left: 0;
        	width: 100%;
        	height: 100%;
        	background-color: rgba(0, 0, 0, 0.5);
        	display: none;
        	z-index: 1000;
    	}

    	.modal-overlay.active {
        	display: flex;
        	align-items: center;
        	justify-content: center;
    	}

    	/* Modal Content */
    	.modal-content {
        	background-color: white;
        	border-radius: 8px;
        	max-width: 800px;
        	width: 90%;
        	max-height: 90vh;
        	overflow-y: auto;
        	box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    	}

    	.modal-header {
        	background-color: #0070d2;
        	color: white;
        	padding: 20px;
        	border-radius: 8px 8px 0 0;
        	display: flex;
        	justify-content: space-between;
        	align-items: center;
    	}

    	.modal-close {
        	background: none;
        	border: none;
        	color: white;
        	font-size: 24px;
        	cursor: pointer;
        	padding: 0;
        	width: 30px;
        	height: 30px;
        	display: flex;
        	align-items: center;
        	justify-content: center;
    	}

    	.modal-close:hover {
        	background-color: rgba(255, 255, 255, 0.1);
        	border-radius: 4px;
    	}

    	.modal-body {
        	padding: 24px;
    	}

    	/* Profile Sections */
    	.profile-section {
        	margin-bottom: 24px;
        	padding-bottom: 24px;
        	border-bottom: 1px solid #dddbda;
    	}

    	.profile-section:last-child {
        	border-bottom: none;
        	margin-bottom: 0;
        	padding-bottom: 0;
    	}

    	.profile-section h3 {
        	color: #0070d2;
        	margin-bottom: 12px;
    	}

    	.profile-field {
        	margin-bottom: 12px;
    	}

    	.profile-field label {
        	font-weight: 600;
        	color: #3e3e3c;
        	margin-right: 8px;
    	}

    	.accommodation-tag {
        	display: inline-block;
        	background-color: #e1f3ff;
        	color: #0070d2;
        	padding: 4px 8px;
        	border-radius: 4px;
        	font-size: 12px;
        	margin-right: 8px;
        	margin-bottom: 8px;
    	}

    	.modal-footer {
        	padding: 16px 24px;
        	border-top: 1px solid #dddbda;
        	display: flex;
        	justify-content: flex-end;
        	gap: 8px;
    	}

    	/* Chat Interface Styles */
    	.chat-container {
        	height: calc(100vh - 200px);
        	display: flex;
        	flex-direction: column;
    	}

    	.chat-messages {
        	flex: 1;
        	overflow-y: auto;
        	padding: 16px;
        	background-color: #f9f9f9;
        	border-radius: 8px;
        	margin-bottom: 16px;
    	}

    	.chat-message {
        	margin-bottom: 16px;
        	display: flex;
        	gap: 12px;
    	}

    	.chat-message.user {
        	flex-direction: row-reverse;
    	}

    	.chat-avatar {
        	width: 40px;
        	height: 40px;
        	border-radius: 50%;
        	display: flex;
        	align-items: center;
        	justify-content: center;
        	font-size: 20px;
        	flex-shrink: 0;
    	}

    	.chat-avatar.einstein {
        	background-color: #0070d2;
        	color: white;
    	}

    	.chat-avatar.user {
        	background-color: #4bca81;
        	color: white;
    	}

    	.chat-bubble {
        	max-width: 70%;
        	padding: 12px 16px;
        	border-radius: 16px;
        	position: relative;
    	}

    	.chat-bubble.einstein {
        	background-color: white;
        	border: 1px solid #dddbda;
        	border-radius: 16px 16px 16px 4px;
    	}

    	.chat-bubble.user {
        	background-color: #0070d2;
        	color: white;
        	border-radius: 16px 16px 4px 16px;
    	}

    	.chat-input-container {
        	display: flex;
        	gap: 12px;
        	padding: 16px;
        	background-color: white;
        	border-radius: 8px;
        	border: 1px solid #dddbda;
    	}

    	.chat-input {
        	flex: 1;
        	padding: 12px;
        	border: 1px solid #dddbda;
        	border-radius: 8px;
        	font-size: 14px;
    	}

    	.chat-input:focus {
        	outline: none;
        	border-color: #0070d2;
        	box-shadow: 0 0 0 3px rgba(0, 112, 210, 0.1);
    	}

    	.chat-suggestions {
        	margin-bottom: 16px;
    	}

    	.suggestion-chips {
        	display: flex;
        	flex-wrap: wrap;
        	gap: 8px;
    	}

    	.suggestion-chip {
        	background-color: #e1f3ff;
        	color: #0070d2;
        	padding: 8px 16px;
        	border-radius: 20px;
        	font-size: 14px;
        	cursor: pointer;
        	transition: all 0.2s;
        	border: 1px solid transparent;
    	}

    	.suggestion-chip:hover {
        	background-color: #0070d2;
        	color: white;
        	border-color: #0070d2;
    	}

    	/* Lesson Plans Styles */
    	.lesson-grid {
        	display: grid;
        	grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        	gap: 16px;
        	margin-bottom: 24px;
    	}

    	.lesson-card {
        	background: white;
        	border-radius: 8px;
        	border: 1px solid #dddbda;
        	overflow: hidden;
        	transition: all 0.2s;
    	}

    	.lesson-card:hover {
        	box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    	}

    	.lesson-card-header {
        	padding: 16px;
        	border-bottom: 1px solid #dddbda;
    	}

    	.lesson-card-body {
        	padding: 16px;
    	}

    	.lesson-card-footer {
        	padding: 16px;
        	background-color: #f9f9f9;
        	border-top: 1px solid #dddbda;
        	display: flex;
        	justify-content: space-between;
        	align-items: center;
    	}

    	.lesson-status {
        	display: inline-block;
        	padding: 4px 8px;
        	border-radius: 4px;
        	font-size: 12px;
        	font-weight: 600;
    	}

    	.lesson-status.draft {
        	background-color: #fff3cd;
        	color: #856404;
    	}

    	.lesson-status.published {
        	background-color: #d4edda;
        	color: #155724;
    	}

    	.lesson-status.scheduled {
        	background-color: #cce5ff;
        	color: #004085;
    	}

    	/* Loading Animation */
    	.loading {
        	display: flex;
        	align-items: center;
        	gap: 8px;
        	color: #706e6b;
        	font-style: italic;
    	}

    	.typing-indicator {
        	display: flex;
        	gap: 4px;
        	padding: 20px;
    	}

    	.typing-dot {
        	width: 8px;
        	height: 8px;
        	background-color: #706e6b;
        	border-radius: 50%;
        	animation: typing 1s infinite;
    	}

    	.typing-dot:nth-child(2) {
        	animation-delay: 0.2s;
    	}

    	.typing-dot:nth-child(3) {
        	animation-delay: 0.4s;
    	}

    	@keyframes typing {
        	0% { opacity: 0.3; transform: translateY(0); }
        	50% { opacity: 1; transform: translateY(-4px); }
        	100% { opacity: 0.3; transform: translateY(0); }
    	}
	</style>

</head>
<body>
	<!-- Student Profile Modal -->
	<div class="modal-overlay" id="student-profile-modal">
    	<div class="modal-content">
        	<div class="modal-header">
            	<h2>Student Profile</h2>
            	<button class="modal-close" onclick="closeStudentProfile()">&times;</button>
        	</div>
        	<div class="modal-body" id="student-profile-content">
            	<!-- Profile content will be inserted here -->
        	</div>
        	<div class="modal-footer">
            	<button class="sf-button sf-button-secondary" onclick="editStudentProfile()">Edit Profile</button>
            	<button class="sf-button sf-button-secondary" onclick="downloadStudentProfile()">Download PDF</button>
            	<button class="sf-button sf-button-primary" onclick="saveStudentProfile()">Save</button>
        	</div>
    	</div>
	</div>

	<!-- Main Header -->
	<header class="sf-header">
    	<div class="sf-logo">
        	<div class="einstein-logo">üß†</div>
        	<div class="app-title">EduNavigator</div>
        	<div class="einstein-badge">Einstein AI</div>
    	</div>
	</header>

	<!-- Navigation -->
	<nav class="sf-nav">
    	<ul class="sf-nav-list">
        	<li class="sf-nav-item active" onclick="switchTab('home', this)">Home</li>
        	<li class="sf-nav-item" onclick="switchTab('eduspace', this)">EduSpace</li>
        	<li class="sf-nav-item" onclick="switchTab('students', this)">Students</li>
    	</ul>
	</nav>

	<!-- Main Container -->
	<div class="sf-container">
    	<!-- Sidebar -->
    	<aside class="sf-sidebar">
        	<div class="sf-sidebar-item active" data-content="dashboard" onclick="showSidebarContent('dashboard', this)">
            	<span>üìä</span> Dashboard
        	</div>
        	<div class="sf-sidebar-item" data-content="current-students" onclick="showSidebarContent('current-students', this)">
            	<span>üë•</span> Current Students
        	</div>
        	<div class="sf-sidebar-item" data-content="lesson-plans" onclick="showSidebarContent('lesson-plans', this)">
            	<span>üìù</span> Lesson Plans
        	</div>
        	<div class="sf-sidebar-item" data-content="einstein-chat" onclick="showSidebarContent('einstein-chat', this)">
            	<span>üß†</span> Einstein Chat
        	</div>
    	</aside>

    	<!-- Content Area -->
    	<main class="sf-content">
        	<!-- Home Tab -->
        	<div id="home-content" class="tab-content active">
            	<div id="sidebar-content-area">
                	<!-- Dashboard Content (Default) -->
                	<div id="dashboard-content" class="sidebar-content active">
                    	<div class="page-header">
                        	<div class="page-header-title">
                            	<h1>Dashboard</h1>
                        	</div>
                        	<button class="sf-button sf-button-primary" onclick="switchTab('eduspace', document.querySelector('[onclick*=eduspace]'))">Get Started</button>
                    	</div>

                    	<div class="progress-path">
                        	<div class="progress-step">
                            	<div class="progress-circle active">1</div>
                            	<span class="progress-label">Home</span>
                        	</div>
                        	<div class="progress-line"></div>
                        	<div class="progress-step">
                            	<div class="progress-circle">2</div>
                            	<span class="progress-label">EduSpace</span>
                        	</div>
                        	<div class="progress-line"></div>
                        	<div class="progress-step">
                            	<div class="progress-circle">3</div>
                            	<span class="progress-label">Students</span>
                        	</div>
                    	</div>

                    	<div class="einstein-box">
                        	<h3>üß† Welcome to EduNavigator</h3>
                        	<p>Let's set up your personalized education system. Click "Get Started" to begin.</p>
                    	</div>
                	</div>

                	<!-- Current Students Content -->
                	<div id="current-students-content" class="sidebar-content">
                    	<div class="page-header">
                        	<div class="page-header-title">
                            	<h1>Current Students</h1>
                        	</div>
                        	<button class="sf-button sf-button-primary" onclick="switchTab('students', document.querySelector('[onclick*=students]'))">Add New Student</button>
                    	</div>

                    	<div id="students-list">
                        	<!-- Students list will be dynamically populated here -->
                    	</div>
                	</div>

                	<!-- Lesson Plans Content -->
                	<div id="lesson-plans-content" class="sidebar-content">
                    	<div class="page-header">
                        	<div class="page-header-title">
                            	<h1>Lesson Plans</h1>
                        	</div>
                        	<button class="sf-button sf-button-primary" onclick="createNewLesson()">Create New Lesson</button>
                    	</div>

                    	<div class="sf-card">
                        	<div class="sf-card-header">
                            	<span>Filter Lessons</span>
                        	</div>
                        	<div class="sf-card-body">
                            	<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                	<div class="sf-form-element">
                                    	<label class="sf-form-label">Student</label>
                                    	<select class="sf-form-input" id="lesson-filter-student">
                                        	<option value="">All Students</option>
                                    	</select>
                                	</div>
                                	<div class="sf-form-element">
                                    	<label class="sf-form-label">Subject</label>
                                    	<select class="sf-form-input" id="lesson-filter-subject">
                                        	<option value="">All Subjects</option>
                                        	<option value="math">Mathematics</option>
                                        	<option value="ela">English Language Arts</option>
                                        	<option value="science">Science</option>
                                        	<option value="social-studies">Social Studies</option>
                                    	</select>
                                	</div>
                                	<div class="sf-form-element">
                                    	<label class="sf-form-label">Status</label>
                                    	<select class="sf-form-input" id="lesson-filter-status">
                                        	<option value="">All Status</option>
                                        	<option value="draft">Draft</option>
                                        	<option value="published">Published</option>
                                        	<option value="scheduled">Scheduled</option>
                                    	</select>
                                	</div>
                            	</div>
                        	</div>
                    	</div>

                    	<div class="lesson-grid" id="lesson-plans-grid">
                        	<!-- Sample lesson cards -->
                        	<div class="lesson-card">
                            	<div class="lesson-card-header">
                                	<h3>Introduction to Fractions</h3>
                                	<span class="lesson-status published">Published</span>
                            	</div>
                            	<div class="lesson-card-body">
                                	<p><strong>Subject:</strong> Mathematics</p>
                                	<p><strong>Grade:</strong> 3rd Grade</p>
                                	<p><strong>Duration:</strong> 45 minutes</p>
                                	<p><strong>Student:</strong> Sarah Johnson</p>
                            	</div>
                            	<div class="lesson-card-footer">
                                	<span>Created: 3 days ago</span>
                                	<button class="sf-button sf-button-secondary">View</button>
                            	</div>
                        	</div>

                        	<div class="lesson-card">
                            	<div class="lesson-card-header">
                                	<h3>Plant Life Cycles</h3>
                                	<span class="lesson-status scheduled">Scheduled</span>
                            	</div>
                            	<div class="lesson-card-body">
                                	<p><strong>Subject:</strong> Science</p>
                                	<p><strong>Grade:</strong> 2nd Grade</p>
                                	<p><strong>Duration:</strong> 60 minutes</p>
                                	<p><strong>Student:</strong> Michael Chen</p>
                            	</div>
                            	<div class="lesson-card-footer">
                                	<span>Scheduled: Tomorrow</span>
                                	<button class="sf-button sf-button-secondary">View</button>
                            	</div>
                        	</div>

                        	<div class="lesson-card">
                            	<div class="lesson-card-header">
                                	<h3>Creative Writing Workshop</h3>
                                	<span class="lesson-status draft">Draft</span>
                            	</div>
                            	<div class="lesson-card-body">
                                	<p><strong>Subject:</strong> English Language Arts</p>
                                	<p><strong>Grade:</strong> 4th Grade</p>
                                	<p><strong>Duration:</strong> 50 minutes</p>
                                	<p><strong>Student:</strong> Emma Williams</p>
                            	</div>
                            	<div class="lesson-card-footer">
                                	<span>Last edited: 2 hours ago</span>
                                	<button class="sf-button sf-button-secondary">Edit</button>
                            	</div>
                        	</div>
                    	</div>
                	</div>

                	<!-- Einstein Chat Content -->
                	<div id="einstein-chat-content" class="sidebar-content">
                    	<div class="page-header">
                        	<div class="page-header-title">
                            	<h1>Einstein AI Assistant</h1>
                        	</div>
                    	</div>

                    	<div class="chat-container">
                        	<div class="chat-suggestions">
                            	<p style="margin-bottom: 12px;">Quick suggestions:</p>
                            	<div class="suggestion-chips" id="suggestion-chips">
                                	<!-- Suggestions will be dynamically generated -->
                            	</div>
                        	</div>

                        	<div class="chat-messages" id="chat-messages">
                            	<!-- Initial greeting will be added dynamically -->
                        	</div>

                        	<div class="chat-input-container">
                            	<input type="text" class="chat-input" id="chat-input" placeholder="Ask Einstein anything about teaching..." onkeypress="handleChatKeyPress(event)">
                            	<button class="sf-button sf-button-primary" onclick="sendMessage()">Send</button>
                        	</div>
                    	</div>
                	</div>
            	</div>
        	</div>

        	<!-- EduSpace Tab -->
        	<div id="eduspace-content" class="tab-content">
            	<div class="page-header">
                	<div class="page-header-title">
                    	<h1>EduSpace Configuration</h1>
                	</div>
            	</div>

            	<div class="progress-path">
                	<div class="progress-step">
                    	<div class="progress-circle completed">‚úì</div>
                    	<span class="progress-label">Home</span>
                	</div>
                	<div class="progress-line completed"></div>
                	<div class="progress-step">
                    	<div class="progress-circle active">2</div>
                    	<span class="progress-label">EduSpace</span>
                	</div>
                	<div class="progress-line"></div>
                	<div class="progress-step">
                    	<div class="progress-circle">3</div>
                    	<span class="progress-label">Students</span>
                	</div>
            	</div>

            	<div class="sf-card">
                	<div class="sf-card-header">
                    	Select Your Educational System
                	</div>
                	<div class="sf-card-body">
                    	<p style="margin-bottom: 16px;">Choose your educational approach.</p>
                   	 
                    	<div class="sf-form-element">
	<label class="sf-form-label">Educational System Type</label>
	<select class="sf-form-input" id="edu-system" onchange="updateSystemInfo()">
    	<option value="">Select System</option>
    	<optgroup label="State Standards">
        	<option value="ca-standards">California State Standards</option>
        	<option value="ny-standards">New York State Standards</option>
        	<option value="tx-standards">Texas State Standards (TEKS)</option>
        	<option value="fl-standards">Florida State Standards</option>
    	</optgroup>
    	<optgroup label="Educational Philosophies">
        	<option value="montessori">Montessori Method</option>
        	<option value="waldorf">Waldorf/Steiner Education</option>
        	<option value="classical">Classical Education</option>
    	</optgroup>
    	<optgroup label="Religious Education">
        	<option value="catholic">Catholic School</option>
        	<option value="christian">Christian School</option>
        	<option value="jewish">Jewish Day School</option>
    	</optgroup>
    	<optgroup label="International">
        	<option value="ib">International Baccalaureate (IB)</option>
        	<option value="british">British Curriculum</option>
    	</optgroup>
    	<optgroup label="Other">
        	<option value="tbd">TBD</option>
        	<option value="consultation">I would like an EduNav consultation to help me choose</option>
    	</optgroup>
	</select>
</div>
                    	<div id="system-details" style="display: none; margin-top: 24px;">
                        	<div class="einstein-box">
                            	<h3 id="system-name">Selected System</h3>
                            	<p id="system-description">System description will appear here.</p>
                        	</div>
                    	</div>

                    	<div class="nav-buttons">
                        	<button class="sf-button sf-button-secondary" onclick="switchTab('home', document.querySelector('[onclick*=home]'))">Back to Home</button>
                        	<button class="sf-button sf-button-primary" onclick="saveSystemAndContinue()" id="eduspace-continue-btn" disabled>Save and Continue</button>
                    	</div>
                	</div>
            	</div>
        	</div>

        	<!-- Students Tab -->
        	<div id="students-content" class="tab-content">
            	<div class="page-header">
                	<div class="page-header-title">
                    	<h1>Student Profile Setup</h1>
                	</div>
            	</div>

            	<div class="progress-path">
                	<div class="progress-step">
                    	<div class="progress-circle completed">‚úì</div>
                    	<span class="progress-label">Home</span>
                	</div>
                	<div class="progress-line completed"></div>
                	<div class="progress-step">
                    	<div class="progress-circle completed">‚úì</div>
                    	<span class="progress-label">EduSpace</span>
                	</div>
                	<div class="progress-line completed"></div>
                	<div class="progress-step">
                    	<div class="progress-circle active">3</div>
                    	<span class="progress-label">Students</span>
                	</div>
            	</div>

            	<div class="sf-card">
                	<div class="sf-card-body">
                    	<div class="guided-form">
                        	<!-- Step 1: Student Name -->
                        	<div id="student-step-1" class="form-step active">
                            	<h3>Step 1: Student Information</h3>
                            	<p>Let's start with the basic information about your student.</p>
                           	 
                            	<div class="sf-form-element">
                                	<label class="sf-form-label">Student Name</label>
                                	<input type="text" class="sf-form-input" id="student-name" placeholder="Enter student's full name">
                            	</div>

                            	<div class="nav-buttons">
                                	<button class="sf-button sf-button-secondary" onclick="switchTab('eduspace', document.querySelector('[onclick*=eduspace]'))">Back to EduSpace</button>
                                	<button class="sf-button sf-button-primary" onclick="nextStudentStep(1)">Next</button>
                            	</div>
                        	</div>

                        	<!-- Step 2: Grade Level -->
                        	<div id="student-step-2" class="form-step">
                            	<h3>Step 2: Grade Level</h3>
                            	<p>What grade level is <span class="student-name-placeholder"></span> in?</p>
                           	 
                            	<div class="sf-form-element">
                                	<label class="sf-form-label">Grade Level</label>
                                	<select class="sf-form-input" id="grade-level">
                                    	<option value="">Select Grade</option>
                                    	<option value="prek">Pre-K</option>
                                    	<option value="k">Kindergarten</option>
                                    	<option value="1">1st Grade</option>
                                    	<option value="2">2nd Grade</option>
                                    	<option value="3">3rd Grade</option>
                                    	<option value="4">4th Grade</option>
                                    	<option value="5">5th Grade</option>
                                    	<option value="6">6th Grade</option>
                                    	<option value="7">7th Grade</option>
                                    	<option value="8">8th Grade</option>
                                    	<option value="9">9th Grade</option>
                                    	<option value="10">10th Grade</option>
                                    	<option value="11">11th Grade</option>
                                    	<option value="12">12th Grade</option>
                                	</select>
                            	</div>

                            	<div class="nav-buttons">
                                	<button class="sf-button sf-button-secondary" onclick="previousStudentStep(2)">Back</button>
                                	<button class="sf-button sf-button-primary" onclick="nextStudentStep(2)">Next</button>
                            	</div>
                        	</div>

                        	<!-- Step 3: Subject Focus -->
                        	<div id="student-step-3" class="form-step">
                            	<h3>Step 3: Subject Focus</h3>
                            	<p>What subject area would you like to create a curriculum for?</p>
                           	 
                            	<div class="sf-form-element">
                                	<label class="sf-form-label">Subject</label>
                                	<select class="sf-form-input" id="subject">
                                    	<option value="">Select Subject</option>
                                    	<option value="math">Mathematics</option>
                                    	<option value="ela">English Language Arts</option>
                                    	<option value="science">Science</option>
                                    	<option value="social-studies">Social Studies</option>
                                    	<option value="art">Art</option>
                                    	<option value="music">Music</option>
                                    	<option value="pe">Physical Education</option>
                                    	<option value="foreign-language">Foreign Language</option>
                                    	<option value="all">All Subjects</option>
                                	</select>
                            	</div>

                            	<div class="nav-buttons">
                                	<button class="sf-button sf-button-secondary" onclick="previousStudentStep(3)">Back</button>
                                	<button class="sf-button sf-button-primary" onclick="nextStudentStep(3)">Next</button>
                            	</div>
                        	</div>

                        	<!-- Step 4: Learning Accommodations -->
                        	<div id="student-step-4" class="form-step">
                            	<h3>Step 4: Learning Accommodations</h3>
                            	<p>Does <span class="student-name-placeholder"></span> require any special accommodations?</p>
                           	 
                            	<div class="sf-form-element">
                                	<label class="sf-form-label">Select all that apply:</label>
                                	<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 12px;">
                                    	<label><input type="checkbox" id="iep"> IEP (Individualized Education Program)</label>
                                    	<label><input type="checkbox" id="504"> 504 Plan</label>
                                    	<label><input type="checkbox" id="adhd"> ADHD</label>
                                    	<label><input type="checkbox" id="dyslexia"> Dyslexia</label>
                                    	<label><input type="checkbox" id="autism"> Autism Spectrum</label>
                                    	<label><input type="checkbox" id="gifted"> Gifted/Advanced</label>
                                    	<label><input type="checkbox" id="ell"> English Language Learner</label>
                                    	<label><input type="checkbox" id="visual"> Visual Impairment</label>
                                    	<label><input type="checkbox" id="hearing"> Hearing Impairment</label>
                                    	<label><input type="checkbox" id="physical"> Physical Disability</label>
                                    	<label><input type="checkbox" id="anxiety"> Anxiety/Depression</label>
                                    	<label><input type="checkbox" id="other"> Other Learning Differences</label>
                                	</div>
                            	</div>

                            	<div class="sf-form-element" style="margin-top: 16px;">
                                	<label class="sf-form-label">Additional Notes (Optional)</label>
                                	<textarea class="sf-form-input" id="accommodation-notes" rows="3" placeholder="Any specific accommodations or notes..."></textarea>
                            	</div>

                            	<div class="nav-buttons">
                                	<button class="sf-button sf-button-secondary" onclick="previousStudentStep(4)">Back</button>
                                	<button class="sf-button sf-button-primary" onclick="completeStudentProfile()">Create Student Profile</button>
                            	</div>
                        	</div>

                        	<!-- Success Step -->
                        	<div id="student-step-success" class="form-step">
                            	<div class="success-message">
                                	<span style="font-size: 24px;">‚úì</span>
                                	<div>
                                    	<h3 style="margin: 0;">Student Profile Created Successfully!</h3>
                                    	<p style="margin: 4px 0 0 0;">The profile has been saved and is ready to use.</p>
                                	</div>
                            	</div>

                            	<div style="text-align: center; margin-top: 32px;">
                                	<button class="sf-button sf-button-primary" onclick="openStudentProfile()">View Student Profile</button>
                                	<button class="sf-button sf-button-secondary" onclick="createAnotherStudent()">Add Another Student</button>
                            	</div>
                        	</div>
                    	</div>
                	</div>
            	</div>
        	</div>
    	</main>
	</div>

	<script>
    	// Global state management
    	let userProfile = {
        	educationalSystem: null,
        	currentStudent: null,
        	students: []
    	};

    	// Load saved profile on page load
    	document.addEventListener('DOMContentLoaded', () => {
        	try {
            	// Initialize userProfile with default structure
            	userProfile = {
                	educationalSystem: null,
                	currentStudent: null,
                	students: []
            	};
           	 
            	// Load saved profile
            	const savedProfile = localStorage.getItem('eduNavigatorProfile');
            	if (savedProfile) {
                	const parsedProfile = JSON.parse(savedProfile);
                	// Merge with default structure to ensure all properties exist
                	userProfile = {
                    	...userProfile,
                    	...parsedProfile
                	};
               	 
                	if (userProfile.educationalSystem) {
                    	const eduSystem = document.getElementById('edu-system');
                    	if (eduSystem) {
                        	eduSystem.value = userProfile.educationalSystem;
                        	updateSystemInfo();
                    	}
                	}
                	updateStudentsList();
            	}
           	 
            	// Check for temp student data (in case of incomplete form)
            	const tempStudent = localStorage.getItem('eduNavigatorTempStudent');
            	if (tempStudent) {
                	userProfile.currentStudent = JSON.parse(tempStudent);
                	console.log('Found incomplete student profile:', userProfile.currentStudent);
            	}
           	 
            	// Ensure dashboard is active by default
            	const dashboardItem = document.querySelector('[data-content="dashboard"]');
            	if (dashboardItem) {
                	showSidebarContent('dashboard', dashboardItem);
            	}
           	 
            	console.log('App initialized successfully', userProfile);
        	} catch (error) {
            	console.error('Error during initialization:', error);
            	// Reset to default state if there's an error
            	userProfile = {
                	educationalSystem: null,
                	currentStudent: null,
                	students: []
            	};
        	}
    	});

    	// Tab switching
    	function switchTab(tabName, element) {
        	// Update nav items
        	document.querySelectorAll('.sf-nav-item').forEach(item => {
            	item.classList.remove('active');
        	});
        	element.classList.add('active');
       	 
        	// Hide all tab content
        	document.querySelectorAll('.tab-content').forEach(content => {
            	content.classList.remove('active');
        	});
       	 
        	// Show selected tab
        	const tabContent = document.getElementById(tabName + '-content');
        	if (tabContent) {
            	tabContent.classList.add('active');
        	}
       	 
        	// If switching to home tab, ensure dashboard is shown by default
        	if (tabName === 'home') {
            	showSidebarContent('dashboard', document.querySelector('.sf-sidebar-item'));
        	}
    	}

    	// Sidebar content management
    	function showSidebarContent(contentType, element) {
        	console.log('Switching to:', contentType); // Debug log
       	 
        	// Only work if we're on the home tab
        	const homeContent = document.getElementById('home-content');
        	if (!homeContent.classList.contains('active')) {
            	// Switch to home tab first
            	switchTab('home', document.querySelector('[onclick*="home"]'));
        	}
       	 
        	// Update sidebar items
        	document.querySelectorAll('.sf-sidebar-item').forEach(item => {
            	item.classList.remove('active');
        	});
        	element.classList.add('active');
       	 
        	// Hide all sidebar content
        	document.querySelectorAll('.sidebar-content').forEach(content => {
            	content.classList.remove('active');
        	});
       	 
        	// Show selected content
        	const contentId = contentType + '-content';
        	const contentElement = document.getElementById(contentId);
        	if (contentElement) {
            	contentElement.classList.add('active');
            	console.log('Activated:', contentId); // Debug log
        	} else {
            	console.error('Content not found:', contentId); // Debug log
        	}
       	 
        	// Update students list if needed
        	if (contentType === 'current-students') {
            	updateStudentsList();
        	} else if (contentType === 'lesson-plans') {
            	updateLessonFilters();
        	} else if (contentType === 'einstein-chat') {
            	initializeEinsteinChat();
        	}
    	}
   	 
    	// Initialize Einstein Chat
    	function initializeEinsteinChat() {
        	const messagesDiv = document.getElementById('chat-messages');
        	if (!messagesDiv) return;
       	 
        	// Clear existing messages
        	messagesDiv.innerHTML = '';
       	 
        	// Generate contextual greeting
        	let greeting = '<div class="chat-message einstein"><div class="chat-avatar einstein">üß†</div><div class="chat-bubble einstein">';
       	 
        	if (userProfile.currentStudent && userProfile.educationalSystem) {
            	const student = userProfile.currentStudent;
            	const systemName = getSystemName(userProfile.educationalSystem);
           	 
            	greeting += `<p>Hello! I'm Einstein, your AI teaching assistant. I see you're working with <strong>${student.name}</strong> in <strong>${getGradeDisplay(student.grade)}</strong> focusing on <strong>${getSubjectDisplay(student.subject)}</strong>.</p>`;
           	 
            	greeting += `<p>Based on your <strong>${systemName}</strong> curriculum, I can help you with:</p>`;
           	 
            	if (userProfile.educationalSystem === 'ca-standards') {
                	greeting += `<ul style="margin-top: 8px; padding-left: 20px;">
                    	<li>California state standards for ${getGradeDisplay(student.grade)} ${getSubjectDisplay(student.subject)}</li>
                    	<li>CAASPP-aligned assessments and practice</li>
                    	<li>CA Framework-based lesson planning</li>
                    	<li>Standards-based grading rubrics</li>`;
            	} else {
                	greeting += `<ul style="margin-top: 8px; padding-left: 20px;">
                    	<li>${systemName} curriculum guidelines</li>
                    	<li>Standards-aligned lesson plans</li>
                    	<li>Grade-appropriate assessments</li>`;
            	}
           	 
            	if (student.accommodations && student.accommodations.length > 0) {
                	greeting += `<li>Specific accommodations for ${student.accommodations.map(a => getAccommodationDisplay(a)).join(', ')}</li>`;
            	}
           	 
            	greeting += `<li>Differentiated instruction strategies</li></ul>`;
            	greeting += `<p style="margin-top: 8px;">What would you like to work on today?</p>`;
        	} else {
            	greeting += `<p>Hello! I'm Einstein, your AI teaching assistant. I can help you with:</p>
                	<ul style="margin-top: 8px; padding-left: 20px;">
                    	<li>Creating personalized lesson plans</li>
                    	<li>Generating educational content</li>
                    	<li>Adapting materials for different learning styles</li>
                    	<li>Answering curriculum questions</li>
                    	<li>Providing teaching strategies</li>
                	</ul>
                	<p style="margin-top: 8px;">To provide the most relevant help, consider setting up a student profile first. What would you like help with today?</p>`;
        	}
       	 
        	greeting += '</div></div>';
        	messagesDiv.innerHTML = greeting;
       	 
        	// Update suggestion chips
        	updateSuggestionChips();
    	}
   	 
    	// Helper function to update suggestion chips
    	function updateSuggestionChips() {
        	const chipsContainer = document.getElementById('suggestion-chips');
        	if (!chipsContainer) return;
       	 
        	let suggestions = [];
       	 
        	if (userProfile.currentStudent && userProfile.educationalSystem) {
            	const student = userProfile.currentStudent;
            	const grade = getGradeDisplay(student.grade);
            	const subject = getSubjectDisplay(student.subject);
           	 
            	if (userProfile.educationalSystem === 'ca-standards') {
                	if (subject === 'English Language Arts') {
                    	suggestions = [
                        	`Create ${grade} poetry lesson using CA standards`,
                        	`Generate CA ELA assessment for ${grade}`,
                        	`Poetry analysis activities for ${grade}`,
                        	`CA Framework writing strategies for ${student.name}`
                    	];
                	} else if (subject === 'Mathematics') {
                    	suggestions = [
                        	`Create ${grade} math lesson with CA standards`,
                        	`CAASPP math practice for ${grade}`,
                        	`CA math framework activities`,
                        	`Problem-solving strategies for ${student.name}`
                    	];
                	} else {
                    	suggestions = [
                        	`Create ${subject} lesson for ${grade}`,
                        	`CA standards alignment for ${subject}`,
                        	`Assessment strategies for ${grade}`,
                        	`Differentiation ideas for ${student.name}`
                    	];
                	}
            	} else {
                	suggestions = [
                    	`Create ${subject} lesson for ${grade}`,
                    	`Generate assessment for ${student.name}`,
                    	`Differentiation strategies for ${grade}`,
                    	`Curriculum alignment help`
                	];
            	}
           	 
            	// Add accommodation-specific suggestions if needed
            	if (student.accommodations && student.accommodations.length > 0) {
                	suggestions.push(`Accommodations for ${student.name}`);
            	}
        	} else {
            	// Default suggestions
            	suggestions = [
                	'Create a lesson plan',
                	'Generate assessment questions',
                	'Help with curriculum planning',
                	'Teaching strategies'
            	];
        	}
       	 
        	chipsContainer.innerHTML = suggestions.map(suggestion =>
            	`<div class="suggestion-chip" onclick="sendSuggestion('${suggestion}')">${suggestion}</div>`
        	).join('');
    	}
   	 
    	// Update lesson plan filters with student names
    	function updateLessonFilters() {
        	const studentFilter = document.getElementById('lesson-filter-student');
        	if (studentFilter && userProfile.students.length > 0) {
            	studentFilter.innerHTML = '<option value="">All Students</option>';
            	userProfile.students.forEach(student => {
                	studentFilter.innerHTML += `<option value="${student.id}">${student.name}</option>`;
            	});
        	}
    	}

    	// EduSpace system selection
    	function updateSystemInfo() {
    const select = document.getElementById('edu-system');
    const value = select.value;
    const detailsDiv = document.getElementById('system-details');
    const continueBtn = document.getElementById('eduspace-continue-btn');
    
    if (value) {
        const systemInfo = {
            'ca-standards': {
                name: 'California State Standards',
                description: 'California State Board of Education adopted standards for K-12 education.'
            },
            'ny-standards': {
                name: 'New York State Learning Standards',
                description: 'NYS Next Generation Learning Standards for all subjects.'
            },
            'tx-standards': {
                name: 'Texas State Standards (TEKS)',
                description: 'State standards for Texas public schools.'
            },
            'fl-standards': {
                name: 'Florida State Standards',
                description: 'Florida academic standards for K-12 education.'
            },
            'montessori': {
                name: 'Montessori Method',
                description: 'Child-centered educational approach based on scientific observations.'
            },
            'waldorf': {
                name: 'Waldorf/Steiner Education',
                description: 'Holistic approach emphasizing imagination and creativity.'
            },
            'classical': {
                name: 'Classical Education',
                description: 'Traditional liberal arts education with trivium and quadrivium.'
            },
            'catholic': {
                name: 'Catholic School Standards',
                description: 'Academic excellence integrated with Catholic faith and values.'
            },
            'christian': {
                name: 'Christian School Standards',
                description: 'Biblical worldview integrated with rigorous academics.'
            },
            'jewish': {
                name: 'Jewish Day School',
                description: 'Dual curriculum of secular and Judaic studies.'
            },
            'ib': {
                name: 'International Baccalaureate',
                description: 'International education framework developing inquiring, knowledgeable young people.'
            },
            'british': {
                name: 'British Curriculum',
                description: 'UK National Curriculum adapted for international schools.'
            },
            'tbd': {
                name: 'TBD (To Be Determined)',
                description: 'Educational approach to be determined. EduNavigator will help with standards alignment based on your student\'s needs.'
            },
            'consultation': {
                name: 'EduNavigator Consultation',
                description: 'Our education specialists will help you select the most appropriate educational approach for your student\'s unique needs and goals.'
            }
        };
        
        if (systemInfo[value]) {
            document.getElementById('system-name').textContent = systemInfo[value].name;
            document.getElementById('system-description').textContent = systemInfo[value].description;
            detailsDiv.style.display = 'block';
            continueBtn.disabled = false;
        }
    } else {
        detailsDiv.style.display = 'none';
        continueBtn.disabled = true;
    }
}

    	function saveSystemAndContinue() {
        	const system = document.getElementById('edu-system').value;
        	if (system) {
            	userProfile.educationalSystem = system;
            	localStorage.setItem('eduNavigatorProfile', JSON.stringify(userProfile));
           	 
            	// Find the Students tab and click it
            	const studentsTab = Array.from(document.querySelectorAll('.sf-nav-item')).find(item =>
                	item.textContent.includes('Students')
            	);
            	if (studentsTab) {
                	switchTab('students', studentsTab);
            	}
        	} else {
            	alert('Please select an educational system before continuing.');
        	}
    	}

    	// Student profile management
    	function nextStudentStep(currentStep) {
        	let isValid = true;
        	let value = '';
       	 
        	try {
            	switch(currentStep) {
                	case 1:
                    	value = document.getElementById('student-name').value.trim();
                    	isValid = value.length > 0;
                    	if (isValid) {
                        	// Initialize or preserve existing student data
                        	if (!userProfile.currentStudent) {
                            	userProfile.currentStudent = {
                                	id: Date.now(),
                                	createdDate: new Date().toISOString()
                            	};
                        	}
                        	userProfile.currentStudent.name = value;
                       	 
                        	// Update placeholders
                        	document.querySelectorAll('.student-name-placeholder').forEach(el => {
                            	el.textContent = value;
                        	});
                       	 
                        	console.log('Step 1 completed, student:', userProfile.currentStudent);
                    	} else {
                        	alert('Please enter the student\'s name.');
                    	}
                    	break;
                   	 
                	case 2:
                    	value = document.getElementById('grade-level').value;
                    	isValid = value !== '';
                    	if (isValid) {
                        	if (!userProfile.currentStudent) {
                            	alert('Error: Student data lost. Please start over.');
                            	return;
                        	}
                        	userProfile.currentStudent.grade = value;
                        	console.log('Step 2 completed, student:', userProfile.currentStudent);
                    	} else {
                        	alert('Please select a grade level.');
                    	}
                    	break;
                   	 
                	case 3:
                    	value = document.getElementById('subject').value;
                    	isValid = value !== '';
                    	if (isValid) {
                        	if (!userProfile.currentStudent) {
                            	alert('Error: Student data lost. Please start over.');
                            	return;
                        	}
                        	userProfile.currentStudent.subject = value;
                        	console.log('Step 3 completed, student:', userProfile.currentStudent);
                    	} else {
                        	alert('Please select a subject.');
                    	}
                    	break;
            	}
           	 
            	if (isValid) {
                	// Save progress to prevent data loss
                	localStorage.setItem('eduNavigatorTempStudent', JSON.stringify(userProfile.currentStudent));
               	 
                	document.getElementById(`student-step-${currentStep}`).classList.remove('active');
                	document.getElementById(`student-step-${currentStep + 1}`).classList.add('active');
            	}
        	} catch (error) {
            	console.error('Error in nextStudentStep:', error);
            	alert('An error occurred. Please try again.');
        	}
    	}

    	function previousStudentStep(currentStep) {
        	document.getElementById(`student-step-${currentStep}`).classList.remove('active');
        	document.getElementById(`student-step-${currentStep - 1}`).classList.add('active');
    	}

    	function completeStudentProfile() {
        	try {
            	console.log('Starting completeStudentProfile...');
            	console.log('Current student before completion:', userProfile.currentStudent);
           	 
            	// Check if we have student data
            	if (!userProfile.currentStudent) {
                	// Try to recover from temp storage
                	const tempStudent = localStorage.getItem('eduNavigatorTempStudent');
                	if (tempStudent) {
                    	userProfile.currentStudent = JSON.parse(tempStudent);
                    	console.log('Recovered student from temp storage:', userProfile.currentStudent);
                	} else {
                    	alert('Error: No student data found. Please start over.');
                    	resetStudentForm();
                    	return;
                	}
            	}
           	 
            	// Get accommodations
            	const accommodations = [];
            	const checkboxes = document.querySelectorAll('#student-step-4 input[type="checkbox"]:checked');
            	checkboxes.forEach(checkbox => {
                	accommodations.push(checkbox.id);
            	});
           	 
            	// Get notes
            	const notesElement = document.getElementById('accommodation-notes');
            	const notes = notesElement ? notesElement.value : '';
           	 
            	// Add to current student
            	userProfile.currentStudent.accommodations = accommodations;
            	userProfile.currentStudent.notes = notes;
           	 
            	// Ensure we have all required fields
            	if (!userProfile.currentStudent.name || !userProfile.currentStudent.grade || !userProfile.currentStudent.subject) {
                	alert('Error: Missing required student information. Please complete all steps.');
                	console.error('Incomplete student data:', userProfile.currentStudent);
                	return;
            	}
           	 
            	// Initialize students array if needed
            	if (!userProfile.students) {
                	userProfile.students = [];
            	}
           	 
            	// Check if student already exists (for editing)
            	const existingIndex = userProfile.students.findIndex(s => s.id === userProfile.currentStudent.id);
            	if (existingIndex >= 0) {
                	userProfile.students[existingIndex] = userProfile.currentStudent;
                	console.log('Updated existing student at index:', existingIndex);
            	} else {
                	userProfile.students.push(userProfile.currentStudent);
                	console.log('Added new student to array');
            	}
           	 
            	// Save to localStorage
            	try {
                	localStorage.setItem('eduNavigatorProfile', JSON.stringify(userProfile));
                	console.log('Successfully saved profile to localStorage');
            	} catch (storageError) {
                	console.error('Error saving to localStorage:', storageError);
                	alert('Error saving profile. Your browser may have storage disabled.');
                	return;
            	}
           	 
            	// Clear temp storage
            	localStorage.removeItem('eduNavigatorTempStudent');
           	 
            	// Show success
            	document.getElementById('student-step-4').classList.remove('active');
            	document.getElementById('student-step-success').classList.add('active');
           	 
            	console.log('Student profile completed successfully:', userProfile.currentStudent);
            	console.log('All students:', userProfile.students);
           	 
        	} catch (error) {
            	console.error('Error in completeStudentProfile:', error);
            	alert('An error occurred while saving the student profile: ' + error.message);
        	}
    	}
   	 
    	// Helper function to reset the student form
    	function resetStudentForm() {
        	userProfile.currentStudent = null;
        	localStorage.removeItem('eduNavigatorTempStudent');
       	 
        	// Reset to step 1
        	document.querySelectorAll('.form-step').forEach(step => {
            	step.classList.remove('active');
        	});
        	document.getElementById('student-step-1').classList.add('active');
       	 
        	// Clear form fields
        	document.getElementById('student-name').value = '';
        	document.getElementById('grade-level').value = '';
        	document.getElementById('subject').value = '';
        	document.querySelectorAll('#student-step-4 input[type="checkbox"]').forEach(cb => cb.checked = false);
        	const notesElement = document.getElementById('accommodation-notes');
        	if (notesElement) notesElement.value = '';
    	}

    	function openStudentProfile() {
        	const student = userProfile.currentStudent;
        	const system = userProfile.educationalSystem;
       	 
        	const profileContent = `
            	<div class="profile-section">
                	<h3>Basic Information</h3>
                	<div class="profile-field">
                    	<label>Name:</label> ${student.name}
                	</div>
                	<div class="profile-field">
                    	<label>Grade Level:</label> ${getGradeDisplay(student.grade)}
                	</div>
                	<div class="profile-field">
                    	<label>Subject Focus:</label> ${getSubjectDisplay(student.subject)}
                	</div>
                	<div class="profile-field">
                    	<label>Educational System:</label> ${getSystemName(system)}
                	</div>
                	<div class="profile-field">
                    	<label>Profile Created:</label> ${new Date(student.createdDate).toLocaleDateString()}
                	</div>
            	</div>
           	 
            	${student.accommodations.length > 0 ? `
            	<div class="profile-section">
                	<h3>Learning Accommodations</h3>
                	<div>
                    	${student.accommodations.map(acc =>
                        	`<span class="accommodation-tag">${getAccommodationDisplay(acc)}</span>`
                    	).join('')}
                	</div>
            	</div>
            	` : ''}
           	 
            	${student.notes ? `
            	<div class="profile-section">
                	<h3>Additional Notes</h3>
                	<p>${student.notes}</p>
            	</div>
            	` : ''}
           	 
            	<div class="profile-section">
                	<h3>Quick Actions</h3>
                	<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px;">
                    	<div class="sf-card" style="text-align: center; padding: 16px; cursor: pointer;" onclick="generateCurriculumFromProfile()">
                        	<div style="font-size: 32px; margin-bottom: 8px;">üìö</div>
                        	<h4>Generate Curriculum</h4>
                        	<p style="font-size: 14px; color: #706e6b;">Create full curriculum plan</p>
                    	</div>
                    	<div class="sf-card" style="text-align: center; padding: 16px; cursor: pointer;" onclick="createLessonPlanFromProfile()">
                        	<div style="font-size: 32px; margin-bottom: 8px;">üìù</div>
                        	<h4>Create Lesson Plan</h4>
                        	<p style="font-size: 14px; color: #706e6b;">Design individual lessons</p>
                    	</div>
                    	<div class="sf-card" style="text-align: center; padding: 16px; cursor: pointer;" onclick="viewProgressTracking()">
                        	<div style="font-size: 32px; margin-bottom: 8px;">üìä</div>
                        	<h4>Progress Tracking</h4>
                        	<p style="font-size: 14px; color: #706e6b;">Monitor learning progress</p>
                    	</div>
                	</div>
            	</div>
        	`;
       	 
        	document.getElementById('student-profile-content').innerHTML = profileContent;
        	document.getElementById('student-profile-modal').classList.add('active');
    	}

    	function closeStudentProfile() {
        	document.getElementById('student-profile-modal').classList.remove('active');
    	}

    	function editStudentProfile() {
        	closeStudentProfile();
        	// Reset to first step with current student data
        	document.getElementById('student-step-success').classList.remove('active');
        	document.getElementById('student-step-1').classList.add('active');
       	 
        	// Populate fields with current data
        	document.getElementById('student-name').value = userProfile.currentStudent.name;
        	document.getElementById('grade-level').value = userProfile.currentStudent.grade;
        	document.getElementById('subject').value = userProfile.currentStudent.subject;
    	}

    	function downloadStudentProfile() {
        	alert('Student profile PDF download would be implemented here.');
    	}

    	function saveStudentProfile() {
        	try {
            	// The profile is already saved, but this confirms the action
            	localStorage.setItem('eduNavigatorProfile', JSON.stringify(userProfile));
            	closeStudentProfile();
           	 
            	// Show success message
            	const successMessage = document.createElement('div');
            	successMessage.className = 'success-message';
            	successMessage.style.position = 'fixed';
            	successMessage.style.top = '20px';
            	successMessage.style.right = '20px';
            	successMessage.style.zIndex = '1001';
            	successMessage.innerHTML = `
                	<span style="font-size: 24px;">‚úì</span>
                	<div>
                    	<h3 style="margin: 0;">Profile Saved!</h3>
                    	<p style="margin: 4px 0 0 0;">Student profile has been updated successfully.</p>
                	</div>
            	`;
            	document.body.appendChild(successMessage);
           	 
            	// Remove the message after 3 seconds
            	setTimeout(() => {
                	successMessage.remove();
            	}, 3000);
           	 
            	console.log('Student profile saved successfully');
        	} catch (error) {
            	console.error('Error saving student profile:', error);
            	alert('Error saving profile. Please try again.');
        	}
    	}

    	function generateCurriculumFromProfile() {
        	closeStudentProfile();
        	alert('Curriculum generation would be implemented here.');
    	}
   	 
    	function createLessonPlanFromProfile() {
        	closeStudentProfile();
        	// Switch to lesson plans tab
        	showSidebarContent('lesson-plans', document.querySelector('[data-content="lesson-plans"]'));
        	createNewLesson();
    	}
   	 
    	function viewProgressTracking() {
        	closeStudentProfile();
        	alert('Progress tracking would be implemented here.');
    	}

    	function createAnotherStudent() {
        	resetStudentForm();
    	}

    	function updateStudentsList() {
        	const studentsListDiv = document.getElementById('students-list');
        	if (!studentsListDiv) return;
       	 
        	if (userProfile.students.length === 0) {
            	studentsListDiv.innerHTML = `
                	<div class="sf-card">
                    	<div class="sf-card-body" style="text-align: center; padding: 40px;">
                        	<p>No students added yet.</p>
                        	<button class="sf-button sf-button-primary" onclick="switchTab('students', document.querySelector('[onclick*=students]'))">Add Your First Student</button>
                    	</div>
                	</div>
            	`;
        	} else {
            	studentsListDiv.innerHTML = `
                	<div class="sf-card">
                    	<div class="sf-card-body">
                        	<table style="width: 100%; border-collapse: collapse;">
                            	<thead>
                                	<tr style="border-bottom: 1px solid #dddbda;">
                                    	<th style="padding: 12px; text-align: left;">Name</th>
                                    	<th style="padding: 12px; text-align: left;">Grade</th>
                                    	<th style="padding: 12px; text-align: left;">Subject</th>
                                    	<th style="padding: 12px; text-align: left;">Actions</th>
                                	</tr>
                            	</thead>
                            	<tbody>
                                	${userProfile.students.map(student => `
                                    	<tr style="border-bottom: 1px solid #f0f0f0;">
                                        	<td style="padding: 12px;">${student.name}</td>
                                        	<td style="padding: 12px;">${getGradeDisplay(student.grade)}</td>
                                        	<td style="padding: 12px;">${getSubjectDisplay(student.subject)}</td>
                                        	<td style="padding: 12px;">
                                            	<button class="sf-button sf-button-secondary" onclick="viewStudentProfile('${student.id}')">View Profile</button>
                                        	</td>
                                    	</tr>
                                	`).join('')}
                            	</tbody>
                        	</table>
                    	</div>
                	</div>
            	`;
        	}
    	}

    	function viewStudentProfile(studentId) {
        	const student = userProfile.students.find(s => s.id == studentId);
        	if (student) {
            	userProfile.currentStudent = student;
            	openStudentProfile();
        	}
    	}

    	// Einstein Chat functions
    	function sendMessage() {
        	const input = document.getElementById('chat-input');
        	const message = input.value.trim();
       	 
        	if (message) {
            	addUserMessage(message);
            	input.value = '';
           	 
            	// Show typing indicator
            	showTypingIndicator();
           	 
            	// Simulate AI response after a delay
            	setTimeout(() => {
                	try {
                    	removeTypingIndicator();
                    	addEinsteinResponse(message);
                	} catch (error) {
                    	console.error('Error in Einstein response:', error);
                    	removeTypingIndicator();
                    	// Show error message
                    	const messagesDiv = document.getElementById('chat-messages');
                    	messagesDiv.innerHTML += `
                        	<div class="chat-message einstein">
                            	<div class="chat-avatar einstein">üß†</div>
                            	<div class="chat-bubble einstein">I apologize, but I encountered an error processing your request. Please try rephrasing your question or contact support if the issue persists.</div>
                        	</div>
                    	`;
                    	messagesDiv.scrollTop = messagesDiv.scrollHeight;
                	}
            	}, 1500);
        	}
    	}

    	function handleChatKeyPress(event) {
        	if (event.key === 'Enter') {
            	sendMessage();
        	}
    	}

    	// Updated sendSuggestion function with error handling
function sendSuggestion(suggestion) {
    try {
        console.log("Suggestion clicked:", suggestion); // Debug log
        
        // Set the input value
        const input = document.getElementById('chat-input');
        if (!input) {
            console.error("Chat input element not found");
            return;
        }
        
        // Set the input value to the suggestion text
        input.value = suggestion;
        
        // Add user message to the chat (ensures the user message appears)
        addUserMessage(suggestion);
        
        // Clear the input
        input.value = '';
        
        // Show typing indicator
        showTypingIndicator();
        
        // Process the suggestion with a small delay
        setTimeout(() => {
            try {
                // Remove typing indicator
                removeTypingIndicator();
                
                // Generate Einstein's response based on the suggestion
                processEinsteinSuggestionResponse(suggestion);
            } catch (error) {
                console.error("Error processing suggestion:", error);
                removeTypingIndicator();
                
                // Show fallback error message
                const messagesDiv = document.getElementById('chat-messages');
                if (messagesDiv) {
                    // Create fallback message element
                    const errorElement = document.createElement('div');
                    errorElement.className = 'chat-message einstein';
                    errorElement.innerHTML = `
                        <div class="chat-avatar einstein">üß†</div>
                        <div class="chat-bubble einstein">
                            <p>I apologize, but I encountered an error processing your suggestion.</p>
                            <p>Please try typing your request directly or select a different suggestion.</p>
                        </div>
                    `;
                    
                    // Add to chat and scroll
                    messagesDiv.appendChild(errorElement);
                    messagesDiv.scrollTop = errorElement.offsetTop - 20;
                }
            }
        }, 1000);
    } catch (error) {
        console.error("Error in sendSuggestion:", error);
        alert("Error processing suggestion. Please try again.");
    }
}

// New function to process suggestion responses separately from regular chat
function processEinsteinSuggestionResponse(suggestion) {
    const messagesDiv = document.getElementById('chat-messages');
    if (!messagesDiv) return;
    
    // Extract relevant keywords from the suggestion
    const lowercaseSuggestion = suggestion.toLowerCase();
    let response = '';
    
    // Get context from user profile for better suggestion handling
    const currentStudent = userProfile.currentStudent;
    const educationalSystem = userProfile.educationalSystem;
    
    // Process different types of suggestions
    if (lowercaseSuggestion.includes('create') && lowercaseSuggestion.includes('lesson')) {
        if (currentStudent) {
            response = handleLessonCreation(currentStudent, educationalSystem);
        } else {
            response = "To create a personalized lesson plan, let's first set up a student profile. Would you like to add a student now?";
        }
    } 
    else if (lowercaseSuggestion.includes('generate') && lowercaseSuggestion.includes('assessment')) {
        if (currentStudent) {
            response = handleAssessmentGeneration(currentStudent, educationalSystem);
        } else {
            response = "I'd be happy to help generate assessment materials. To make them more relevant, let's first set up a student profile. Would you like to do that now?";
        }
    }
    else if (lowercaseSuggestion.includes('accommodation')) {
        if (currentStudent && currentStudent.accommodations && currentStudent.accommodations.length > 0) {
            response = handleDifferentiation(currentStudent, educationalSystem);
        } else {
            response = "I can provide differentiation strategies for various learning needs. Do you have specific accommodations in mind for your student?";
        }
    }
    else if (lowercaseSuggestion.includes('curriculum') || lowercaseSuggestion.includes('planning')) {
        if (educationalSystem) {
            if (currentStudent) {
                response = handleCurriculumRequest(currentStudent, educationalSystem);
            } else {
                response = `I can help with curriculum planning for your ${getSystemName(educationalSystem)} approach. What grade level and subject would you like to focus on?`;
            }
        } else {
            response = "I'd be happy to help with curriculum planning. To get started, what educational system or approach are you using?";
        }
    }
    else if (lowercaseSuggestion.includes('strategy') || lowercaseSuggestion.includes('strategies')) {
        response = `Here are some teaching strategies that might be helpful:

**Direct Instruction Strategies:**
‚Ä¢ Clear learning objectives
‚Ä¢ Explicit modeling of skills
‚Ä¢ Guided practice with feedback
‚Ä¢ Independent practice

**Active Learning Strategies:**
‚Ä¢ Think-pair-share discussions
‚Ä¢ Collaborative problem-solving
‚Ä¢ Student-led demonstrations
‚Ä¢ Project-based learning

**Assessment Strategies:**
‚Ä¢ Exit tickets for quick formative assessment
‚Ä¢ Student self-assessment rubrics
‚Ä¢ Peer feedback protocols
‚Ä¢ Portfolio assessment

Would you like me to elaborate on any of these teaching approaches?`;
    }
    else {
        // Default response for other suggestions
        response = `I'd be happy to help with "${suggestion}". Could you provide a bit more detail about what specific aspect you're interested in?`;
    }
    
    // Format the response
    let formattedResponse = response;
    try {
        formattedResponse = formatResponseText(response);
    } catch (error) {
        console.error("Error formatting suggestion response:", error);
    }
    
    // Create and add the message element
    const newMessageElement = document.createElement('div');
    newMessageElement.className = 'chat-message einstein';
    newMessageElement.innerHTML = `
        <div class="chat-avatar einstein">üß†</div>
        <div class="chat-bubble einstein">${formattedResponse}</div>
    `;
    
    // Add to chat and scroll
    messagesDiv.appendChild(newMessageElement);
    messagesDiv.scrollTop = newMessageElement.offsetTop - 20;
}

    	function addUserMessage(message) {
    const messagesDiv = document.getElementById('chat-messages');
    
    // Create message element
    const userMessageElement = document.createElement('div');
    userMessageElement.className = 'chat-message user';
    userMessageElement.innerHTML = `
        <div class="chat-avatar user">üë§</div>
        <div class="chat-bubble user">${message}</div>
    `;
    
    // Add to DOM
    messagesDiv.appendChild(userMessageElement);
    
    // Calculate and set scroll position
    const messagePosition = userMessageElement.offsetTop - 20;
    messagesDiv.scrollTop = messagePosition;
}

    	function showTypingIndicator() {
    const messagesDiv = document.getElementById('chat-messages');
    
    // Create indicator element
    const indicatorElement = document.createElement('div');
    indicatorElement.className = 'chat-message einstein';
    indicatorElement.id = 'typing-indicator';
    indicatorElement.innerHTML = `
        <div class="chat-avatar einstein">üß†</div>
        <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    `;
    
    // Add to DOM
    messagesDiv.appendChild(indicatorElement);
    
    // Calculate and set scroll position
    const indicatorPosition = indicatorElement.offsetTop - 20;
    messagesDiv.scrollTop = indicatorPosition;
}
    	function removeTypingIndicator() {
        	const indicator = document.getElementById('typing-indicator');
        	if (indicator) {
            	indicator.remove();
        	}
    	}

    	// First add these two new helper functions
// Enhanced formatting functions for better responsiveness
// Updated addEinsteinResponse function with proper scrolling behavior
function addEinsteinResponse(userMessage){
    try {
        const messagesDiv = document.getElementById('chat-messages');
        let response = '';
        
        // Get context from user profile
        const educationalSystem = userProfile.educationalSystem;
        const currentStudent = userProfile.currentStudent;
        const students = userProfile.students;
        
        // Analyze the user's message more intelligently
        const lowercaseMessage = userMessage.toLowerCase();
        
        // Check if user has completed profile setup
        if (!educationalSystem || students.length === 0) {
            response = `I notice you haven't completed your profile setup yet. To provide you with the most relevant and specific help, I need to know:

1. Your educational system (e.g., California State Standards, Montessori, IB)
2. Your student's grade level and subject focus

Would you like to complete the setup first? Just click on the "EduSpace" tab to select your educational system, then add your student information. Once that's done, I can provide specific, standards-aligned content for your needs.`;
            
        } else if (currentStudent) {
            // We have student data - provide contextual responses
            const grade = currentStudent.grade;
            const subject = currentStudent.subject;
            const studentName = currentStudent.name;
            
            // Handle specific suggestion patterns
            if (lowercaseMessage.includes('generate') && lowercaseMessage.includes('assessment')) {
                response = handleAssessmentGeneration(currentStudent, educationalSystem);
            } else if (lowercaseMessage.includes('create') && lowercaseMessage.includes('lesson')) {
                response = handleLessonCreation(currentStudent, educationalSystem);
            } else if (lowercaseMessage.includes('differentiation') || lowercaseMessage.includes('accommodation')) {
                response = handleDifferentiation(currentStudent, educationalSystem);
            } else if (lowercaseMessage.includes('poetry')) {
                response = handlePoetryRequest(currentStudent, educationalSystem);
            } else if (lowercaseMessage.includes('curriculum') || lowercaseMessage.includes('standard')) {
                response = handleCurriculumRequest(currentStudent, educationalSystem);
            } else {
                // Route to specific educational system handlers
                switch(educationalSystem) {
                    case 'ca-standards':
                        response = handleCaliforniaStandards(userMessage, currentStudent);
                        break;
                    case 'ny-standards':
                        response = handleNewYorkStandards(userMessage, currentStudent);
                        break;
                    case 'tx-standards':
                        response = handleTexasStandards(userMessage, currentStudent);
                        break;
                    case 'fl-standards':
                        response = handleFloridaStandards(userMessage, currentStudent);
                        break;
                    case 'montessori':
                        response = handleMontessoriMethod(userMessage, currentStudent);
                        break;
                    case 'waldorf':
                        response = handleWaldorfEducation(userMessage, currentStudent);
                        break;
                    case 'classical':
                        response = handleClassicalEducation(userMessage, currentStudent);
                        break;
                    case 'catholic':
                        response = handleCatholicEducation(userMessage, currentStudent);
                        break;
                    case 'jewish':
                        response = handleJewishEducation(userMessage, currentStudent);
                        break;
                    case 'ib':
                        response = handleIBCurriculum(userMessage, currentStudent);
                        break;
                    case 'british':
                        response = handleBritishCurriculum(userMessage, currentStudent);
                        break;
                    default:
                        response = handleGenericEducation(userMessage, currentStudent);
                }
            }
            
            // Add accommodation suggestions if student has them
            if (currentStudent.accommodations && currentStudent.accommodations.length > 0) {
                response += `\n\n**Note:** I see ${studentName} has the following accommodations: ${currentStudent.accommodations.map(a => getAccommodationDisplay(a)).join(', ')}. I'll ensure any resources I provide include appropriate modifications.`;
            }
            
        } else {
            // Multiple students but no current student selected
            response = `I see you have ${students.length} student${students.length > 1 ? 's' : ''} in your profile. To provide specific help, which student would you like to focus on?

${students.map((student, index) => 
                    `${index + 1}. ${student.name} - ${getGradeDisplay(student.grade)} ${getSubjectDisplay(student.subject)}`
                ).join('\n')}

Once you tell me which student, I can provide targeted assistance based on their grade level and your ${getSystemName(educationalSystem)} curriculum.`;
        }

        // Format the response
        let formattedResponse;
        try {
            formattedResponse = formatResponseText(response);
        } catch (formatError) {
            console.error('Error formatting response:', formatError);
            formattedResponse = response; // Fallback to unformatted text
        }
        
        // Create a new message element
        const newMessageElement = document.createElement('div');
        newMessageElement.className = 'chat-message einstein';
        newMessageElement.innerHTML = `
            <div class="chat-avatar einstein">üß†</div>
            <div class="chat-bubble einstein">${formattedResponse}</div>
        `;
        
        // Add to DOM
        messagesDiv.appendChild(newMessageElement);
        
        // Calculate position to scroll to (top of the new message minus a small margin)
        const newMessagePosition = newMessageElement.offsetTop - 20;
        
        // Scroll to show the beginning of the message
        messagesDiv.scrollTop = newMessagePosition;
        
    } catch (error) {
        console.error('Error in addEinsteinResponse:', error);
        // Fallback response
        const messagesDiv = document.getElementById('chat-messages');
        
        // Create message element
        const errorElement = document.createElement('div');
        errorElement.className = 'chat-message einstein';
        errorElement.innerHTML = `
            <div class="chat-avatar einstein">üß†</div>
            <div class="chat-bubble einstein">
                <p>I understand you need help with: "${userMessage}".</p>
                <p>Let me provide you with some guidance. What specific aspect would you like me to focus on?</p>
            </div>
        `;
        
        // Add to DOM and scroll properly
        messagesDiv.appendChild(errorElement);
        messagesDiv.scrollTop = errorElement.offsetTop - 20;
    }
}
// New formatting function to convert plain text to properly formatted HTML
function formatResponseText(text) {
	if (!text) return '';
    
	// Split text into paragraphs
	let paragraphs = text.split('\n\n');
    
	// Process each paragraph
	let formattedHtml = '';
    
	for (let i = 0; i < paragraphs.length; i++) {
    	let paragraph = paragraphs[i].trim();
   	 
    	if (!paragraph) continue; // Skip empty paragraphs
   	 
    	// Handle bullet lists (lines starting with ‚Ä¢ or - or *)
    	if (paragraph.includes('\n‚Ä¢ ') || paragraph.includes('\n- ') || paragraph.includes('\n* ')) {
        	// Split into lines
        	let lines = paragraph.split('\n');
        	let inList = false;
       	 
        	for (let line of lines) {
            	line = line.trim();
            	if (!line) continue;
           	 
            	// Check if this is a list item
            	if (line.startsWith('‚Ä¢ ') || line.startsWith('- ') || line.startsWith('* ')) {
                	// Start a list if not already in one
                	if (!inList) {
                    	formattedHtml += '<ul style="margin-left: 20px; margin-bottom: 12px;">';
                    	inList = true;
                	}
                	// Add list item
                	let itemContent = line.substring(2).trim();
               	 
                	// Handle nested lists (indented bullets)
                	if (itemContent.includes('\n  ‚Ä¢ ') || itemContent.includes('\n  - ') || itemContent.includes('\n  * ')) {
                    	let nestedItems = itemContent.split(/\n\s{2}[‚Ä¢\-*] /);
                    	let mainItem = nestedItems[0];
                    	formattedHtml += `<li>${formatInlineText(mainItem)}`;
                   	 
                    	if (nestedItems.length > 1) {
                        	formattedHtml += '<ul style="margin-left: 20px; margin-top: 6px;">';
                        	for (let j = 1; j < nestedItems.length; j++) {
                            	formattedHtml += `<li>${formatInlineText(nestedItems[j])}</li>`;
                        	}
                        	formattedHtml += '</ul>';
                    	}
                   	 
                    	formattedHtml += '</li>';
                	} else {
                    	formattedHtml += `<li>${formatInlineText(itemContent)}</li>`;
                	}
            	} else {
                	// End list if we were in one
                	if (inList) {
                    	formattedHtml += '</ul>';
                    	inList = false;
                	}
                	// Regular paragraph line
                	formattedHtml += `<p>${formatInlineText(line)}</p>`;
            	}
        	}
       	 
        	// Close any open list
        	if (inList) {
            	formattedHtml += '</ul>';
        	}
    	}
    	// Handle headings (lines with ** at beginning and end, or starting with #)
    	else if (paragraph.startsWith('**') && paragraph.endsWith('**')) {
        	let headingText = paragraph.substring(2, paragraph.length - 2);
        	formattedHtml += `<h3 style="margin-bottom: 8px; color: #0070d2;">${headingText}</h3>`;
    	}
    	// Handle standard paragraphs
    	else {
        	formattedHtml += `<p style="margin-bottom: 12px;">${formatInlineText(paragraph)}</p>`;
    	}
	}
    
	return formattedHtml;
}

// Format inline text elements like bold, italic, etc.
function formatInlineText(text) {
	// Format bold text (enclosed in **)
	text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    
	// Format italic text (enclosed in single *)
	text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
    
	// Format code or technical terms (enclosed in backticks)
	text = text.replace(/`(.*?)`/g, '<code>$1</code>');
    
	return text;
}
   	 
    	// Handler functions for common suggestion patterns
    	function handleAssessmentGeneration(student, system) {
        	const systemName = getSystemName(system);
        	const grade = getGradeDisplay(student.grade);
        	const subject = getSubjectDisplay(student.subject);
       	 
        	return `I'll help you create an assessment for ${student.name} (${grade} ${subject}) using ${systemName}.

**Assessment Options:**
1. **Formative Assessment** - Quick checks for understanding
2. **Summative Assessment** - End of unit/chapter test
3. **Performance Task** - Applied learning demonstration
4. **Portfolio Assessment** - Collection of work over time
5. **Diagnostic Assessment** - Pre-unit knowledge check

**Format Options:**
‚Ä¢ Multiple choice questions
‚Ä¢ Short answer responses
‚Ä¢ Extended writing prompts
‚Ä¢ Problem-solving tasks
‚Ä¢ Project-based evaluations

Which type of assessment would you like me to create? Please specify:
- Assessment type
- Specific topic or standard
- Duration (quick check vs. full period)
- Any special accommodations needed`;
    	}
   	 
    	function handleLessonCreation(student, system) {
        	const systemName = getSystemName(system);
        	const grade = getGradeDisplay(student.grade);
        	const subject = getSubjectDisplay(student.subject);
       	 
        	return `I'll create a lesson plan for ${student.name} (${grade} ${subject}) aligned with ${systemName}.

**Lesson Planning Options:**
1. **Introduction Lesson** - New concept introduction
2. **Practice Lesson** - Skill reinforcement
3. **Review Lesson** - Test preparation
4. **Project Lesson** - Hands-on application
5. **Assessment Lesson** - Evaluation activities

**Lesson Components I'll Include:**
‚Ä¢ Learning objectives aligned to standards
‚Ä¢ Materials and resources needed
‚Ä¢ Step-by-step instructional plan
‚Ä¢ Differentiation strategies
‚Ä¢ Assessment methods
‚Ä¢ Homework/extension activities

What specific topic or standard would you like the lesson to cover?`;
    	}
   	 
    	function handleDifferentiation(student, system) {
        	const accommodations = student.accommodations || [];
        	const hasAccommodations = accommodations.length > 0;
       	 
        	let response = `I'll provide differentiation strategies for ${student.name} (${getGradeDisplay(student.grade)} ${getSubjectDisplay(student.subject)}).`;
       	 
        	if (hasAccommodations) {
            	response += `\n\n**Specific Accommodations for ${student.name}:**`;
            	accommodations.forEach(acc => {
                	response += `\n\n**${getAccommodationDisplay(acc)}:**\n${getAccommodationStrategies(acc)}`;
            	});
        	}
       	 
        	response += `\n\n**General Differentiation Strategies:**
1. **Content** - What students learn
   ‚Ä¢ Tiered reading materials
   ‚Ä¢ Varied complexity levels
   ‚Ä¢ Multiple resource formats

2. **Process** - How students learn
   ‚Ä¢ Flexible grouping
   ‚Ä¢ Learning centers
   ‚Ä¢ Choice in activities

3. **Product** - How students show learning
   ‚Ä¢ Multiple assessment options
   ‚Ä¢ Varied project formats
   ‚Ä¢ Student choice in demonstration

4. **Learning Environment**
   ‚Ä¢ Flexible seating
   ‚Ä¢ Quiet work areas
   ‚Ä¢ Collaborative spaces

Which aspect of differentiation would you like me to focus on?`;
       	 
        	return response;
    	}
   	 
    	function handlePoetryRequest(student, system) {
        	const grade = student.grade;
        	const systemName = getSystemName(system);
       	 
        	// System-specific poetry handling
        	if (system === 'ca-standards') {
            	return handleCaliforniaPoetry(student);
        	} else if (system === 'ny-standards') {
            	return handleNewYorkPoetry(student);
        	}
       	 
        	// Generic poetry response
        	return `I'll help you with poetry for ${student.name} (${getGradeDisplay(grade)}) using ${systemName}.

**Poetry Unit Components:**
1. **Poetry Analysis** - Understanding elements and meaning
2. **Poetry Writing** - Creating original works
3. **Poetry Performance** - Recitation and presentation
4. **Poetry Comparison** - Analyzing multiple poems

**Key Poetry Elements for Grade ${grade}:**
‚Ä¢ Rhyme and rhythm patterns
‚Ä¢ Figurative language (similes, metaphors)
‚Ä¢ Poetic devices (alliteration, onomatopoeia)
‚Ä¢ Structure (stanzas, line breaks)
‚Ä¢ Theme and mood

What specific aspect of poetry would you like to focus on?`;
    	}
   	 
    	function handleCurriculumRequest(student, system) {
        	const systemName = getSystemName(system);
        	const grade = getGradeDisplay(student.grade);
        	const subject = getSubjectDisplay(student.subject);
       	 
        	return `I'll provide curriculum information for ${student.name} (${grade} ${subject}) based on ${systemName}.

**Curriculum Components:**
1. **Standards Overview** - Key learning objectives
2. **Scope and Sequence** - Year-long progression
3. **Unit Planning** - Major topics and themes
4. **Assessment Guidelines** - Evaluation methods
5. **Resource Recommendations** - Materials and tools

Would you like me to:
‚Ä¢ Provide specific standards for a topic?
‚Ä¢ Create a curriculum map for the year?
‚Ä¢ Design a unit plan?
‚Ä¢ Suggest curriculum resources?

Please let me know which aspect interests you most.`;
    	}
   	 
    	function handleCaliforniaPoetry(student) {
        	const grade = student.grade;
        	return `Based on California ELA Standards for ${getGradeDisplay(grade)} and ${student.name}'s profile, here's what we need to cover for poetry:

**California Standards for Grade ${grade} Poetry:**
${getCaliforniaPoetryStandards(grade)}

**Essential Questions for Poetry Unit:**
1. How do poets use language to create meaning and emotion?
2. What are the structural elements that make poetry unique?
3. How does cultural perspective influence poetry?

**Suggested Poetry Activities for ${student.name}:**
1. **Poetry Analysis** - Using TPCASTT method aligned with RL.${grade}.4
2. **Create Original Poetry** - Following specific forms (haiku, cinquain, free verse)
3. **Poetry Performance** - Addresses Speaking & Listening standards
4. **Comparative Analysis** - Compare poems from different cultures (RL.${grade}.9)

**Assessment Ideas (CAASPP-aligned):**
- Selected response questions on figurative language
- Constructed response analyzing theme
- Performance task: Write and present original poem

Would you like me to create a specific lesson plan for any of these activities?`;
    	}
   	 
    	function handleNewYorkPoetry(student) {
        	const grade = student.grade;
        	return `Based on New York State Next Generation Learning Standards for ${getGradeDisplay(grade)} ELA:

**NYS ELA Standards for Poetry (Grade ${grade}):**
${getNewYorkELAStandards(grade)}

**Key Components:**
1. **Reading for Literature** - Analyze literary elements
2. **Reading for Information** - Compare texts
3. **Writing** - Create original works
4. **Speaking & Listening** - Present interpretations

**Poetry Specific Skills:**
- Analyze structural elements (stanza, verse, meter)
- Interpret figurative language
- Compare themes across texts
- Write poetry using mentor texts

**NYS Assessment Alignment:**
- Text-dependent questions
- Evidence-based writing
- Performance-based assessments

Would you like me to create lesson plans aligned to these standards?`;
    	}
   	 
    	function getAccommodationStrategies(accommodation) {
        	const strategies = {
            	'iep': '‚Ä¢ Extended time for assignments\n‚Ä¢ Preferential seating\n‚Ä¢ Modified testing environment\n‚Ä¢ Simplified instructions\n‚Ä¢ Visual aids and graphic organizers',
            	'adhd': '‚Ä¢ Movement breaks every 20-30 minutes\n‚Ä¢ Chunked assignments\n‚Ä¢ Visual schedules and timers\n‚Ä¢ Fidget tools\n‚Ä¢ Reduced distractions',
            	'dyslexia': '‚Ä¢ Text-to-speech software\n‚Ä¢ Colored overlays\n‚Ä¢ Multi-sensory instruction\n‚Ä¢ Extra time for reading\n‚Ä¢ Alternative spelling assessments',
            	'ell': '‚Ä¢ Bilingual glossaries\n‚Ä¢ Visual vocabulary cards\n‚Ä¢ Peer translation support\n‚Ä¢ Simplified language\n‚Ä¢ Cultural context building',
            	'gifted': '‚Ä¢ Curriculum compacting\n‚Ä¢ Advanced projects\n‚Ä¢ Independent study options\n‚Ä¢ Mentorship opportunities\n‚Ä¢ Acceleration options',
            	'autism': '‚Ä¢ Clear routines and structure\n‚Ä¢ Visual schedules\n‚Ä¢ Sensory breaks\n‚Ä¢ Social scripts\n‚Ä¢ Explicit instruction',
            	'504': '‚Ä¢ Environmental modifications\n‚Ä¢ Testing accommodations\n‚Ä¢ Organizational support\n‚Ä¢ Technology assistance\n‚Ä¢ Modified assignments',
            	'anxiety': '‚Ä¢ Stress reduction techniques\n‚Ä¢ Break cards\n‚Ä¢ Alternative presentation formats\n‚Ä¢ Advance notice of changes\n‚Ä¢ Safe space availability'
        	};
        	return strategies[accommodation] || '‚Ä¢ Individualized support strategies\n‚Ä¢ Regular progress monitoring\n‚Ä¢ Collaborative team approach';
    	}
   	 
    	// California Standards Handler
    	function handleCaliforniaStandards(userMessage, student) {
        	const lowercaseMessage = userMessage.toLowerCase();
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	if (lowercaseMessage.includes('poetry') || (lowercaseMessage.includes('ela') && (lowercaseMessage.includes('4') || lowercaseMessage.includes('fourth')))) {
            	return `Based on California ELA Standards for ${getGradeDisplay(grade)} and ${studentName}'s profile, here's what we need to cover for poetry:

**California Standards for Grade ${grade} Poetry:**
${getCaliforniaPoetryStandards(grade)}

**Essential Questions for Poetry Unit:**
1. How do poets use language to create meaning and emotion?
2. What are the structural elements that make poetry unique?
3. How does cultural perspective influence poetry?

**Suggested Poetry Activities for ${studentName}:**
1. **Poetry Analysis** - Using TPCASTT method aligned with RL.${grade}.4
2. **Create Original Poetry** - Following specific forms (haiku, cinquain, free verse)
3. **Poetry Performance** - Addresses Speaking & Listening standards
4. **Comparative Analysis** - Compare poems from different cultures (RL.${grade}.9)

**Assessment Ideas (CAASPP-aligned):**
- Selected response questions on figurative language
- Constructed response analyzing theme
- Performance task: Write and present original poem

Would you like me to create a specific lesson plan for any of these activities?`;
        	}
       	 
        	// Default California response
        	return `I'll help you with ${userMessage} for ${studentName} using California State Standards.

Based on Grade ${grade} ${getSubjectDisplay(subject)} standards:
${getCaliforniaStandardsForSubject(subject, grade)}

How would you like me to help you implement these standards?`;
    	}
   	 
    	// New York Standards Handler
    	function handleNewYorkStandards(userMessage, student) {
        	const lowercaseMessage = userMessage.toLowerCase();
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	if (lowercaseMessage.includes('poetry') || lowercaseMessage.includes('ela')) {
            	return `Based on New York State Next Generation Learning Standards for ${getGradeDisplay(grade)} ELA:

**NYS ELA Standards for Poetry (Grade ${grade}):**
${getNewYorkELAStandards(grade)}

**Key Components:**
1. **Reading for Literature** - Analyze literary elements
2. **Reading for Information** - Compare texts
3. **Writing** - Create original works
4. **Speaking & Listening** - Present interpretations

**Poetry Specific Skills:**
- Analyze structural elements (stanza, verse, meter)
- Interpret figurative language
- Compare themes across texts
- Write poetry using mentor texts

**NYS Assessment Alignment:**
- Text-dependent questions
- Evidence-based writing
- Performance-based assessments

Would you like me to create lesson plans aligned to these standards?`;
        	}
       	 
        	return `Using New York State Next Generation Learning Standards for ${studentName}:

**Grade ${grade} ${getSubjectDisplay(subject)} Standards:**
${getNewYorkStandardsForSubject(subject, grade)}

**NYS Instructional Shifts:**
1. Regular practice with complex texts
2. Reading and writing grounded in evidence
3. Building knowledge through content-rich curriculum

How can I help you implement these standards?`;
    	}
   	 
    	// Texas TEKS Handler
    	function handleTexasStandards(userMessage, student) {
        	const lowercaseMessage = userMessage.toLowerCase();
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	if (lowercaseMessage.includes('poetry') || lowercaseMessage.includes('ela')) {
            	return `Based on Texas Essential Knowledge and Skills (TEKS) for ${getGradeDisplay(grade)} ELAR:

**TEKS ELAR Standards for Poetry (Grade ${grade}):**
${getTexasELARStandards(grade)}

**TEKS Strands:**
1. **Foundational Language Skills** - Oral language, vocabulary
2. **Comprehension Skills** - Literary elements, genres
3. **Response Skills** - Personal connections, evaluations
4. **Multiple Genres** - Poetry analysis and creation
5. **Composition** - Writing poetry, revision process

**STAAR Assessment Focus:**
- Reading comprehension of poetry
- Written analysis of literary devices
- Revising and editing skills

Would you like TEKS-aligned activities for ${studentName}?`;
        	}
       	 
        	return `Using Texas Essential Knowledge and Skills (TEKS) for ${studentName}:

**Grade ${grade} ${getSubjectDisplay(subject)} TEKS:**
${getTexasStandardsForSubject(subject, grade)}

**TEKS Framework:**
- Student expectations with clear learning outcomes
- Process standards for problem-solving
- Cross-curricular connections

How can I help you align instruction to TEKS?`;
    	}
   	 
    	// Florida Standards Handler
    	function handleFloridaStandards(userMessage, student) {
        	const lowercaseMessage = userMessage.toLowerCase();
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	return `Using Florida's B.E.S.T. Standards for ${studentName}:

**Grade ${grade} ${getSubjectDisplay(subject)} B.E.S.T. Standards:**
${getFloridaStandardsForSubject(subject, grade)}

**B.E.S.T. Framework Components:**
1. Benchmarks for Excellent Student Thinking
2. Clear learning progressions
3. Emphasis on critical thinking
4. Integration of foundational skills

**Florida Assessment Alignment:**
- F.A.S.T. (Florida Assessment of Student Thinking)
- Progress monitoring tools
- Standards-based reporting

How would you like to implement these standards?`;
    	}
   	 
    	// Montessori Method Handler
    	function handleMontessoriMethod(userMessage, student) {
        	const age = getMontessoriAgeGroup(student.grade);
        	const studentName = student.name;
       	 
        	return `Using Montessori Method for ${studentName} (${age} level):

**Montessori Curriculum Areas:**
${getMontessoriCurriculum(age)}

**Key Montessori Principles:**
1. **Prepared Environment** - Organized, accessible materials
2. **Self-Directed Learning** - Child chooses activities
3. **Mixed Age Groups** - Peer teaching and modeling
4. **Hands-On Materials** - Concrete before abstract
5. **Uninterrupted Work Periods** - Deep concentration

**Three-Period Lesson Structure:**
1. Introduction - "This is..."
2. Recognition - "Show me..."
3. Recall - "What is...?"

**Assessment Approach:**
- Observation-based evaluation
- Individual progress tracking
- Portfolio documentation

Would you like specific Montessori activities for ${studentName}?`;
    	}
   	 
    	// Waldorf/Steiner Handler
    	function handleWaldorfEducation(userMessage, student) {
        	const grade = student.grade;
        	const studentName = student.name;
       	 
        	return `Using Waldorf/Steiner approach for ${studentName} (Grade ${grade}):

**Waldorf Grade ${grade} Curriculum:**
${getWaldorfCurriculum(grade)}

**Waldorf Educational Principles:**
1. **Developmental Appropriateness** - Age-based curriculum
2. **Artistic Integration** - Arts in all subjects
3. **Rhythm and Repetition** - Daily, weekly, seasonal
4. **Imagination and Creativity** - Storytelling, play
5. **Whole Child Focus** - Head, heart, hands

**Main Lesson Block Structure:**
- 2-hour morning blocks
- 3-4 week subject immersion
- Artistic and practical work

**Assessment Philosophy:**
- Narrative evaluations
- Focus on individual progress
- No standardized testing

How can I help you implement Waldorf methods?`;
    	}
   	 
    	// IB Programme Handler
    	function handleIBCurriculum(userMessage, student) {
        	const programme = getIBProgramme(student.grade);
        	const studentName = student.name;
       	 
        	return `Using International Baccalaureate ${programme} for ${studentName}:

**IB ${programme} Framework:**
${getIBFramework(programme, student.grade)}

**IB Learner Profile Attributes:**
- Inquirers, Knowledgeable, Thinkers
- Communicators, Principled, Open-minded
- Caring, Risk-takers, Balanced, Reflective

**Trans-disciplinary Themes:**
1. Who we are
2. Where we are in place and time
3. How we express ourselves
4. How the world works
5. How we organize ourselves
6. Sharing the planet

**Assessment Principles:**
- Criterion-referenced assessment
- Formative and summative balance
- Student self-assessment

Would you like IB unit planning help for ${studentName}?`;
    	}
   	 
    	// British Curriculum Handler
    	function handleBritishCurriculum(userMessage, student) {
        	const keyStage = getBritishKeyStage(student.grade);
        	const studentName = student.name;
       	 
        	return `Using British National Curriculum for ${studentName} (${keyStage}):

**${keyStage} Curriculum Framework:**
${getBritishCurriculum(keyStage, student.subject)}

**National Curriculum Aims:**
1. Provide broad and balanced education
2. Promote spiritual, moral, cultural development
3. Prepare pupils for opportunities and experiences

**Key Stage Assessments:**
- Ongoing teacher assessment
- End of key stage assessments
- Progress tracking against expectations

**British Educational Terms:**
- Schemes of Work (unit plans)
- Attainment Targets (learning goals)
- Programmes of Study (curriculum content)

How can I help with British curriculum planning?`;
    	}
   	 
    	// Helper functions for each system
    	function getNewYorkELAStandards(grade) {
        	// Add specific NY standards here
        	return `‚Ä¢ Reading Standards for Literature
‚Ä¢ Reading Standards for Informational Text
‚Ä¢ Writing Standards
‚Ä¢ Speaking and Listening Standards
‚Ä¢ Language Standards`;
    	}
   	 
    	function getTexasELARStandards(grade) {
        	return `‚Ä¢ Developing and Sustaining Foundational Language Skills
‚Ä¢ Comprehension Skills
‚Ä¢ Response Skills
‚Ä¢ Multiple Genres
‚Ä¢ Author's Purpose and Craft
‚Ä¢ Composition
‚Ä¢ Inquiry and Research`;
    	}
   	 
    	function getMontessoriAgeGroup(grade) {
        	if (grade === 'prek' || grade === 'k') return 'Primary (3-6 years)';
        	if (parseInt(grade) <= 3) return 'Lower Elementary (6-9 years)';
        	if (parseInt(grade) <= 6) return 'Upper Elementary (9-12 years)';
        	return 'Adolescent (12+ years)';
    	}
   	 
    	function getMontessoriCurriculum(ageGroup) {
        	const curricula = {
            	'Primary (3-6 years)': `‚Ä¢ Practical Life - Care of self and environment
‚Ä¢ Sensorial - Refining senses and perception
‚Ä¢ Mathematics - Concrete mathematical concepts
‚Ä¢ Language - Phonetics, writing, reading
‚Ä¢ Cultural Studies - Geography, science, arts`,
            	'Lower Elementary (6-9 years)': `‚Ä¢ Language Arts - Grammar, composition, literature
‚Ä¢ Mathematics - Four operations, fractions, geometry
‚Ä¢ Cultural Studies - History, geography, sciences
‚Ä¢ Practical Life - Community service, cooking
‚Ä¢ Arts - Music, visual arts, drama`,
            	'Upper Elementary (9-12 years)': `‚Ä¢ Advanced Language Arts - Research, analysis
‚Ä¢ Advanced Mathematics - Algebra, advanced geometry
‚Ä¢ Sciences - Biology, chemistry, physics
‚Ä¢ History - Civilizations, timelines
‚Ä¢ Practical Work - Economics, technology`
        	};
        	return curricula[ageGroup] || curricula['Lower Elementary (6-9 years)'];
    	}
   	 
    	function getWaldorfCurriculum(grade) {
        	const curricula = {
            	'1': 'Fairy tales, letters, numbers, form drawing',
            	'2': 'Fables, cursive writing, four operations',
            	'3': 'Hebrew stories, farming, building, measurement',
            	'4': 'Norse mythology, local geography, fractions',
            	'5': 'Ancient civilizations, botany, decimal fractions',
            	'6': 'Roman history, physics, astronomy, geometry',
            	'7': 'Renaissance, chemistry, physiology, algebra',
            	'8': 'Modern history, organic chemistry, meteorology'
        	};
        	return curricula[grade] || 'Grade-appropriate Waldorf curriculum';
    	}
   	 
    	function getIBProgramme(grade) {
        	if (grade === 'prek' || grade === 'k' || parseInt(grade) <= 5) return 'Primary Years Programme (PYP)';
        	if (parseInt(grade) <= 10) return 'Middle Years Programme (MYP)';
        	return 'Diploma Programme (DP)';
    	}
   	 
    	function getIBFramework(programme, grade) {
        	const frameworks = {
            	'Primary Years Programme (PYP)': `‚Ä¢ Language - Oral, visual, written communication
‚Ä¢ Mathematics - Number, pattern, measurement, data
‚Ä¢ Science - Living things, Earth, materials, forces
‚Ä¢ Social Studies - Human systems, continuity/change
‚Ä¢ Arts - Visual, performing arts
‚Ä¢ Personal, Social, Physical Education`,
            	'Middle Years Programme (MYP)': `‚Ä¢ Language and Literature
‚Ä¢ Language Acquisition
‚Ä¢ Individuals and Societies
‚Ä¢ Sciences
‚Ä¢ Mathematics
‚Ä¢ Arts
‚Ä¢ Physical and Health Education
‚Ä¢ Design`,
            	'Diploma Programme (DP)': `‚Ä¢ Studies in Language and Literature
‚Ä¢ Language Acquisition
‚Ä¢ Individuals and Societies
‚Ä¢ Sciences
‚Ä¢ Mathematics
‚Ä¢ The Arts
‚Ä¢ Core: TOK, CAS, Extended Essay`
        	};
        	return frameworks[programme] || frameworks['Primary Years Programme (PYP)'];
    	}
   	 
    	function getBritishKeyStage(grade) {
        	if (grade === 'prek') return 'Early Years Foundation Stage';
        	if (grade === 'k' || grade === '1') return 'Key Stage 1';
        	if (parseInt(grade) <= 6) return 'Key Stage 2';
        	if (parseInt(grade) <= 9) return 'Key Stage 3';
        	return 'Key Stage 4';
    	}
   	 
    	function getBritishCurriculum(keyStage, subject) {
        	// Simplified British curriculum overview
        	return `‚Ä¢ ${getSubjectDisplay(subject)} Programmes of Study
‚Ä¢ Cross-curricular skills and capabilities
‚Ä¢ Attainment targets and assessment focuses
‚Ä¢ Statutory and non-statutory guidance`;
    	}
   	 
    	// California Standards Helper Functions
    	function getCaliforniaPoetryStandards(grade) {
        	const standards = {
            	'1': `‚Ä¢ RL.1.4 - Identify words and phrases that suggest feelings or appeal to senses
‚Ä¢ RL.1.10 - Read prose and poetry of appropriate complexity
‚Ä¢ W.1.3 - Write narratives with sequences of events`,
            	'2': `‚Ä¢ RL.2.4 - Describe how words supply rhythm and meaning in poetry
‚Ä¢ RL.2.5 - Describe overall structure of a story, including how beginning introduces and ending concludes
‚Ä¢ RL.2.10 - Read and comprehend literature including poetry`,
            	'3': `‚Ä¢ RL.3.4 - Determine meaning of words as they are used, distinguishing literal from non-literal
‚Ä¢ RL.3.5 - Refer to parts of poems when writing or speaking (verse, stanza)
‚Ä¢ W.3.3 - Write narratives using effective technique and descriptive details`,
            	'4': `‚Ä¢ RL.4.4 - Determine meaning of words including figurative language
‚Ä¢ RL.4.5 - Explain major differences between poems, drama, and prose
‚Ä¢ RL.4.9 - Compare treatment of similar themes in different cultures
‚Ä¢ W.4.3.d - Use concrete words, phrases, and sensory details`,
            	'5': `‚Ä¢ RL.5.4 - Determine meaning of words including figurative language like metaphors and similes
‚Ä¢ RL.5.5 - Explain how chapters, scenes, or stanzas fit together
‚Ä¢ RL.5.7 - Analyze how visual elements contribute to meaning
‚Ä¢ W.5.3.d - Use concrete words, phrases, and sensory details`,
            	'6': `‚Ä¢ RL.6.4 - Determine meaning including figurative and connotative meanings
‚Ä¢ RL.6.5 - Analyze how a sentence, chapter, scene, or stanza fits into overall structure
‚Ä¢ RL.6.7 - Compare reading to listening/viewing the same text
‚Ä¢ W.6.3.d - Use precise words, relevant descriptive details, and sensory language`
        	};
        	return standards[grade] || standards['4']; // Default to 4th grade if not found
    	}
   	 
    	function getCaliforniaStandardsForSubject(subject, grade) {
        	if (subject === 'math') {
            	return getMathStandards(grade);
        	} else if (subject === 'ela') {
            	return getELAStandards(grade);
        	} else if (subject === 'science') {
            	return getScienceStandards(grade);
        	} else if (subject === 'social-studies') {
            	return getSocialStudiesStandards(grade);
        	}
        	return "Standards for this subject are being developed.";
    	}
   	 
    	function getTexasStandardsForSubject(subject, grade) {
        	if (subject === 'ela') {
            	return getTexasELARStandards(grade);
        	} else if (subject === 'math') {
            	return `**Texas Mathematics TEKS:**
‚Ä¢ Number and Operations
‚Ä¢ Algebraic Reasoning
‚Ä¢ Geometry and Measurement
‚Ä¢ Data Analysis
‚Ä¢ Personal Financial Literacy`;
        	} else if (subject === 'science') {
            	return `**Texas Science TEKS:**
‚Ä¢ Scientific Investigation and Reasoning
‚Ä¢ Matter and Energy
‚Ä¢ Force, Motion, and Energy
‚Ä¢ Earth and Space
‚Ä¢ Organisms and Environments`;
        	}
        	return `Texas TEKS for ${getSubjectDisplay(subject)}`;
    	}
   	 
    	function getFloridaStandardsForSubject(subject, grade) {
        	if (subject === 'ela') {
            	return `**Florida B.E.S.T. ELA Standards:**
‚Ä¢ Foundational Skills (K-5)
‚Ä¢ Reading Prose and Poetry
‚Ä¢ Reading Informational Text
‚Ä¢ Reading Across Genres
‚Ä¢ Writing
‚Ä¢ Communication`;
        	} else if (subject === 'math') {
            	return `**Florida B.E.S.T. Mathematics Standards:**
‚Ä¢ Number Sense and Operations
‚Ä¢ Algebraic Reasoning
‚Ä¢ Geometric Reasoning
‚Ä¢ Data Analysis and Probability
‚Ä¢ Mathematical Thinking and Reasoning`;
        	}
        	return `Florida B.E.S.T. Standards for ${getSubjectDisplay(subject)}`;
    	}
   	 
    	// Handler for Catholic Education
    	function handleCatholicEducation(userMessage, student) {
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	return `Using Catholic School Standards for ${studentName} (${getGradeDisplay(grade)}):

**Catholic Identity Integration:**
‚Ä¢ Gospel values across all subjects
‚Ä¢ Catholic social teaching connections
‚Ä¢ Prayer and liturgical celebrations
‚Ä¢ Service learning opportunities

**Academic Standards:**
${getCatholicAcademicStandards(subject, grade)}

**Faith Formation:**
‚Ä¢ Religious education curriculum
‚Ä¢ Sacramental preparation (grade-appropriate)
‚Ä¢ Scripture study
‚Ä¢ Catholic traditions and practices

**Character Development:**
‚Ä¢ Virtue education
‚Ä¢ Moral reasoning
‚Ä¢ Community service
‚Ä¢ Global citizenship

How can I help you integrate faith and academics for ${studentName}?`;
    	}
   	 
    	// Handler for Jewish Education
    	function handleJewishEducation(userMessage, student) {
        	const grade = student.grade;
        	const subject = student.subject;
        	const studentName = student.name;
       	 
        	return `Using Jewish Day School Curriculum for ${studentName} (${getGradeDisplay(grade)}):

**Dual Curriculum Approach:**
${getJewishDualCurriculum(subject, grade)}

**Judaic Studies Components:**
‚Ä¢ Hebrew language (modern and biblical)
‚Ä¢ Torah and Tanakh study
‚Ä¢ Jewish history and culture
‚Ä¢ Holidays and traditions
‚Ä¢ Prayer and spirituality

**Integration Opportunities:**
‚Ä¢ Values-based learning
‚Ä¢ Tikkun olam (repairing the world)
‚Ä¢ Jewish perspective in secular subjects
‚Ä¢ Israel studies

**Assessment Balance:**
‚Ä¢ Secular academic standards
‚Ä¢ Hebrew language proficiency
‚Ä¢ Jewish knowledge and practice

Would you like specific integration strategies for ${studentName}?`;
    	}
   	 
    	// Handler for Classical Education
    	function handleClassicalEducation(userMessage, student) {
        	const grade = student.grade;
        	const studentName = student.name;
        	const stage = getClassicalStage(grade);
       	 
        	return `Using Classical Education model for ${studentName} (${stage} stage):

**Classical Trivium Stage: ${stage}**
${getClassicalCurriculum(stage, grade)}

**Classical Education Principles:**
1. **Language-focused** - Reading, writing, speaking
2. **History-intensive** - Chronological study
3. **Virtuous character** - Moral philosophy
4. **Great Books** - Primary sources
5. **Socratic method** - Dialectic reasoning

**Core Subjects Approach:**
‚Ä¢ Latin/Greek study
‚Ä¢ Classical literature
‚Ä¢ Logic and rhetoric
‚Ä¢ Mathematics (classical approach)
‚Ä¢ Natural philosophy (sciences)

**Assessment Methods:**
‚Ä¢ Recitation and memorization
‚Ä¢ Socratic discussions
‚Ä¢ Written compositions
‚Ä¢ Oral presentations

How can I help you implement classical methods for ${studentName}?`;
    	}
   	 
    	// Helper functions for religious and classical education
    	function getCatholicAcademicStandards(subject, grade) {
        	if (subject === 'ela') {
            	return `‚Ä¢ Literature with Catholic themes and values
‚Ä¢ Writing that reflects Catholic worldview
‚Ä¢ Speaking skills for faith sharing
‚Ä¢ Critical thinking with moral reasoning`;
        	} else if (subject === 'science') {
            	return `‚Ä¢ Scientific method as gift from God
‚Ä¢ Environmental stewardship
‚Ä¢ Bioethics and Catholic teaching
‚Ä¢ Wonder and awe in creation`;
        	}
        	return `‚Ä¢ Catholic perspective integrated into ${getSubjectDisplay(subject)}
‚Ä¢ Academic excellence with faith formation`;
    	}
   	 
    	function getJewishDualCurriculum(subject, grade) {
        	return `**General Studies:** Standard academic curriculum
**Judaic Studies:** Hebrew, Torah, Jewish history, practices

**Integration Points:**
‚Ä¢ Jewish values in ${getSubjectDisplay(subject)}
‚Ä¢ Hebrew vocabulary for subject concepts
‚Ä¢ Jewish historical connections
‚Ä¢ Ethical dimensions from Jewish law`;
    	}
   	 
    	function getClassicalStage(grade) {
        	if (grade === 'prek' || grade === 'k' || parseInt(grade) <= 4) {
            	return 'Grammar';
        	} else if (parseInt(grade) <= 8) {
            	return 'Logic/Dialectic';
        	}
        	return 'Rhetoric';
    	}
   	 
    	function getClassicalCurriculum(stage, grade) {
        	const curricula = {
            	'Grammar': `‚Ä¢ Memorization and foundations
‚Ä¢ Phonics and grammar rules
‚Ä¢ Math facts and formulas
‚Ä¢ Historical narratives
‚Ä¢ Nature study and observation`,
            	'Logic/Dialectic': `‚Ä¢ Analytical thinking
‚Ä¢ Formal logic study
‚Ä¢ Cause and effect reasoning
‚Ä¢ Debate and argumentation
‚Ä¢ Abstract mathematical concepts`,
            	'Rhetoric': `‚Ä¢ Persuasive communication
‚Ä¢ Original thesis development
‚Ä¢ Advanced composition
‚Ä¢ Public speaking
‚Ä¢ Synthesis of knowledge`
        	};
        	return curricula[stage] || curricula['Grammar'];
    	}
   	 
    	// Generic handler for any system without specific implementation
    	function handleGenericEducation(userMessage, student) {
        	const systemName = getSystemName(userProfile.educationalSystem);
        	return `I see you're using ${systemName} with ${student.name} in ${getGradeDisplay(student.grade)}.

For "${userMessage}", I can provide general educational support:

1. **Curriculum Planning** - Unit and lesson design
2. **Teaching Strategies** - Best practices
3. **Assessment Methods** - Formative and summative
4. **Differentiation** - Meeting diverse needs
5. **Resource Recommendations** - Educational materials

What specific aspect would you like help with?`;
    	}
   	 
    	function getCaliforniaStandardsForSubject(subject, grade) {
        	if (subject === 'math') {
            	return getMathStandards(grade);
        	} else if (subject === 'ela') {
            	return getELAStandards(grade);
        	} else if (subject === 'science') {
            	return getScienceStandards(grade);
        	} else if (subject === 'social-studies') {
            	return getSocialStudiesStandards(grade);
        	}
        	return "Standards for this subject are being developed.";
    	}
   	 
    	function getMathStandards(grade) {
        	const standards = {
            	'3': `**Operations and Algebraic Thinking**
‚Ä¢ 3.OA.1-9: Multiplication and division within 100, problem solving
**Number Operations in Base Ten**  
‚Ä¢ 3.NBT.1-3: Place value, addition/subtraction within 1000
**Fractions**
‚Ä¢ 3.NF.1-3: Understanding fractions as numbers
**Measurement and Data**
‚Ä¢ 3.MD.1-8: Time, mass, volume, area, perimeter`,
            	'4': `**Operations and Algebraic Thinking**
‚Ä¢ 4.OA.1-5: Multi-step word problems, factors and multiples
**Number Operations in Base Ten**
‚Ä¢ 4.NBT.1-6: Multi-digit arithmetic, place value to 1,000,000  
**Fractions**
‚Ä¢ 4.NF.1-7: Equivalent fractions, comparing, adding/subtracting
**Geometry**
‚Ä¢ 4.G.1-3: Lines, angles, shape classification`,
            	'5': `**Number Operations in Base Ten**
‚Ä¢ 5.NBT.1-7: Decimals to thousandths, multi-digit operations
**Fractions**
‚Ä¢ 5.NF.1-7: Add/subtract/multiply/divide fractions
**Measurement and Data**
‚Ä¢ 5.MD.1-5: Convert measurements, volume
**Geometry**
‚Ä¢ 5.G.1-4: Coordinate plane, classify shapes`
        	};
        	return standards[grade] || "Grade-specific math standards available upon request.";
    	}
   	 
    	function getELAStandards(grade) {
        	const standards = {
            	'3': `**Reading Literature & Informational Text**
‚Ä¢ Key Ideas and Details (RL/RI.3.1-3)
‚Ä¢ Craft and Structure (RL/RI.3.4-6)
‚Ä¢ Integration of Knowledge (RL/RI.3.7-9)
**Writing**
‚Ä¢ Text Types (W.3.1-3): Opinion, informative, narrative
‚Ä¢ Production (W.3.4-6): Planning, revising, technology use
**Speaking & Listening**
‚Ä¢ Comprehension and Collaboration (SL.3.1-3)
‚Ä¢ Presentation of Knowledge (SL.3.4-6)`,
            	'4': `**Reading Literature & Informational Text**
‚Ä¢ Key Ideas and Details (RL/RI.4.1-3)
‚Ä¢ Craft and Structure (RL/RI.4.4-6)
‚Ä¢ Integration of Knowledge (RL/RI.4.7-9)
**Writing**
‚Ä¢ Text Types (W.4.1-3): Opinion, informative, narrative
‚Ä¢ Production (W.4.4-6): Clear writing, planning, revising
‚Ä¢ Research (W.4.7-9): Conduct research, gather evidence
**Language**
‚Ä¢ Conventions (L.4.1-2): Grammar, punctuation, spelling
‚Ä¢ Vocabulary (L.4.4-6): Word meanings, relationships`,
            	'5': `**Reading Literature & Informational Text**
‚Ä¢ Quote accurately from text (RL/RI.5.1)
‚Ä¢ Determine theme or main ideas (RL/RI.5.2)  
‚Ä¢ Compare and contrast texts (RL/RI.5.9)
**Writing**
‚Ä¢ Opinion pieces with supporting reasons (W.5.1)
‚Ä¢ Informative texts with facts and details (W.5.2)
‚Ä¢ Narratives with descriptive details (W.5.3)
**Speaking & Listening**  
‚Ä¢ Engage in collaborative discussions (SL.5.1)
‚Ä¢ Present findings and support with evidence (SL.5.4)`
        	};
        	return standards[grade] || "Grade-specific ELA standards available upon request.";
    	}
   	 
    	function getScienceStandards(grade) {
        	// Using Next Generation Science Standards (NGSS) adopted by California
        	return `**NGSS for Grade ${grade}:**
‚Ä¢ Physical Sciences - Matter, energy, forces, interactions
‚Ä¢ Life Sciences - Organisms, ecosystems, biological evolution
‚Ä¢ Earth & Space Sciences - Earth systems, human activity
‚Ä¢ Engineering Design - Define problems, develop solutions
‚Ä¢ Cross-cutting Concepts - Patterns, cause/effect, systems`;
    	}
   	 
    	function getSocialStudiesStandards(grade) {
        	const standards = {
            	'3': "Communities and Geography - Local and regional communities",
            	'4': "California History - Native Americans, missions, statehood",
            	'5': "United States History - Pre-Columbian to 1850",
            	'6': "Ancient Civilizations - Early humans to fall of Rome"
        	};
        	return standards[grade] || "History-Social Science content for this grade level.";
    	}
   	 
    	function getCaliforniaFrameworkFocus(subject, grade) {
        	if (subject === 'ela') {
            	return `‚Ä¢ Integrated approach to reading, writing, speaking, listening
‚Ä¢ Text complexity and academic vocabulary
‚Ä¢ Close reading and evidence-based responses
‚Ä¢ Balance of literature and informational texts`;
        	} else if (subject === 'math') {
            	return `‚Ä¢ Conceptual understanding before procedures
‚Ä¢ Mathematical practices and problem-solving
‚Ä¢ Real-world applications
‚Ä¢ Building fluency with grade-level skills`;
        	}
        	return "Framework guidance for integrated learning and critical thinking.";
    	}
   	 
    	function getAssessmentStrategies(subject, grade) {
        	if (subject === 'ela') {
            	return `‚Ä¢ Selected response (multiple choice) on reading comprehension
‚Ä¢ Constructed response requiring text evidence
‚Ä¢ Performance tasks combining reading and writing
‚Ä¢ Listening comprehension assessments
‚Ä¢ Speaking presentations with rubrics`;
        	} else if (subject === 'math') {
            	return `‚Ä¢ Conceptual understanding questions
‚Ä¢ Procedural skill and fluency items
‚Ä¢ Problem-solving and modeling tasks
‚Ä¢ Mathematical reasoning explanations
‚Ä¢ Performance tasks with real-world contexts`;
        	}
        	return "Balanced assessment including formative and summative measures.";
    	}

    	// Lesson Plans functions
    	function createNewLesson() {
        	alert('New lesson creation interface would open here.');
    	}

    	// Utility functions
    	function getSystemName(system) {
        	const systemNames = {
            	'ca-standards': 'California State Standards',
            	'ny-standards': 'New York State Standards',
            	'tx-standards': 'Texas State Standards',
            	'fl-standards': 'Florida State Standards',
            	'montessori': 'Montessori Method',
            	'waldorf': 'Waldorf/Steiner Education',
            	'classical': 'Classical Education',
            	'catholic': 'Catholic School',
            	'christian': 'Christian School',
            	'jewish': 'Jewish Day School',
            	'ib': 'International Baccalaureate',
            	'british': 'British Curriculum'
        	};
        	return systemNames[system] || system;
    	}

    	function getGradeDisplay(grade) {
        	const gradeMap = {
            	'prek': 'Pre-K',
            	'k': 'Kindergarten',
            	'1': '1st Grade',
            	'2': '2nd Grade',
            	'3': '3rd Grade',
            	'4': '4th Grade',
            	'5': '5th Grade',
            	'6': '6th Grade',
            	'7': '7th Grade',
            	'8': '8th Grade',
            	'9': '9th Grade',
            	'10': '10th Grade',
            	'11': '11th Grade',
            	'12': '12th Grade'
        	};
        	return gradeMap[grade] || grade;
    	}

    	function getSubjectDisplay(subject) {
        	const subjectMap = {
            	'math': 'Mathematics',
            	'ela': 'English Language Arts',
            	'science': 'Science',
            	'social-studies': 'Social Studies',
            	'art': 'Art',
            	'music': 'Music',
            	'pe': 'Physical Education',
            	'foreign-language': 'Foreign Language',
            	'all': 'All Subjects'
        	};
        	return subjectMap[subject] || subject;
    	}

    	function getAccommodationDisplay(accommodation) {
        	const accommodationMap = {
            	'iep': 'IEP (Individualized Education Program)',
            	'504': '504 Plan',
            	'adhd': 'ADHD Support',
            	'dyslexia': 'Dyslexia Accommodations',
            	'autism': 'Autism Spectrum Support',
            	'gifted': 'Gifted/Advanced Learning',
            	'ell': 'English Language Learner Support',
            	'visual': 'Visual Impairment Accommodations',
            	'hearing': 'Hearing Impairment Accommodations',
            	'physical': 'Physical Disability Accommodations',
            	'anxiety': 'Anxiety/Depression Support',
            	'other': 'Other Learning Differences'
        	};
        	return accommodationMap[accommodation] || accommodation;
    	}
	</script>
</body>
</html>


